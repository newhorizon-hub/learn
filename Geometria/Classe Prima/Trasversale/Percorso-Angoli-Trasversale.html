<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Angoli formati da due rette tagliate da una trasversale</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700&family=DM+Serif+Display&display=swap');

  :root {
    --primary: #1a5276;
    --primary-light: #2980b9;
    --secondary: #f39c12;
    --accent: #e74c3c;
    --bg: #fafbfc;
    --card-bg: #ffffff;
    --text: #2c3e50;
    --text-light: #5d6d7e;
    --success: #27ae60;
    --success-bg: #eafaf1;
    --warning: #f39c12;
    --warning-bg: #fef9e7;
    --error: #e74c3c;
    --error-bg: #fdedec;
    --border: #e8ecf1;
    --shadow: 0 2px 12px rgba(0,0,0,0.08);
    --radius: 12px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.7;
    min-height: 100vh;
  }

  /* HEADER */
  .header {
    background: linear-gradient(135deg, var(--primary) 0%, #1a3c5e 100%);
    color: white;
    padding: 2rem 1.5rem 1.5rem;
    text-align: center;
  }
  .header h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(1.4rem, 4vw, 2rem);
    font-weight: 400;
    letter-spacing: 0.02em;
    margin-bottom: 0.3rem;
  }
  .header p {
    font-size: 0.9rem;
    opacity: 0.8;
  }

  /* PROGRESS BAR */
  .progress-container {
    background: white;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  }
  .progress-steps {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  .progress-step {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.78rem;
    font-weight: 600;
    color: var(--text-light);
    opacity: 0.5;
    transition: all 0.3s;
  }
  .progress-step.active { opacity: 1; color: var(--primary); }
  .progress-step.completed { opacity: 1; color: var(--success); }
  .progress-step .step-num {
    width: 26px; height: 26px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.75rem;
    background: var(--border);
    color: var(--text-light);
    transition: all 0.3s;
  }
  .progress-step.active .step-num { background: var(--primary); color: white; }
  .progress-step.completed .step-num { background: var(--success); color: white; }
  .step-connector {
    width: 20px; height: 2px;
    background: var(--border);
    border-radius: 1px;
  }
  .progress-step.completed + .step-connector { background: var(--success); }

  /* MAIN */
  .main { max-width: 840px; margin: 0 auto; padding: 1.5rem; }

  /* PHASE */
  .phase { display: none; animation: fadeIn 0.4s ease; }
  .phase.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .phase-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.5rem;
    color: var(--primary);
    margin-bottom: 0.4rem;
  }
  .phase-subtitle {
    font-size: 0.9rem;
    color: var(--text-light);
    margin-bottom: 1.5rem;
  }

  /* INSTRUCTION */
  .instruction {
    background: #eef6fc;
    border-left: 4px solid var(--primary-light);
    padding: 0.8rem 1rem;
    border-radius: 0 8px 8px 0;
    margin-bottom: 1.5rem;
    font-size: 0.88rem;
    color: var(--primary);
  }

  /* SVG DIAGRAM */
  .diagram-container {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 1.2rem;
    margin-bottom: 1.5rem;
    text-align: center;
    overflow-x: auto;
  }
  .diagram-container svg {
    max-width: 100%;
    height: auto;
  }

  /* CLICKABLE ANGLE CARDS (Phase 1 & 2) */
  .angle-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .angle-card {
    background: var(--card-bg);
    border: 2px solid var(--border);
    border-radius: var(--radius);
    cursor: pointer;
    transition: all 0.25s;
    overflow: hidden;
  }
  .angle-card:hover { border-color: var(--primary-light); transform: translateY(-2px); box-shadow: var(--shadow); }
  .angle-card.opened { border-color: var(--success); }
  .angle-card-header {
    padding: 1rem 1.2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.8rem;
  }
  .angle-card-header .card-label {
    font-weight: 700;
    font-size: 1rem;
    color: var(--primary);
  }
  .angle-card-header .card-icon {
    font-size: 1.1rem;
    transition: transform 0.25s;
  }
  .angle-card.opened .card-icon { color: var(--success); }
  .angle-card-body {
    display: none;
    padding: 0 1.2rem 1.2rem;
    font-size: 0.9rem;
    line-height: 1.75;
    border-top: 1px solid var(--border);
    padding-top: 1rem;
  }
  .angle-card.opened .angle-card-body { display: block; animation: fadeIn 0.3s; }

  .highlight { color: var(--primary); font-weight: 600; }
  .formula-box {
    background: #f4f7fa;
    border-radius: 8px;
    padding: 0.6rem 0.9rem;
    margin: 0.5rem 0;
    font-size: 0.88rem;
    border-left: 3px solid var(--primary-light);
  }

  /* EXPANDABLE CARDS (Phase 3) */
  .concept-card {
    background: var(--card-bg);
    border: 2px solid var(--border);
    border-radius: var(--radius);
    margin-bottom: 0.8rem;
    overflow: hidden;
    transition: border-color 0.25s;
  }
  .concept-card.opened { border-color: var(--success); }
  .concept-card-header {
    padding: 1rem 1.2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s;
  }
  .concept-card-header:hover { background: #f8f9fa; }
  .concept-card-header .cc-label {
    font-weight: 700;
    font-size: 0.95rem;
  }
  .concept-card-header .cc-arrow {
    font-size: 0.9rem;
    transition: transform 0.3s;
    color: var(--text-light);
  }
  .concept-card.open .cc-arrow { transform: rotate(180deg); }
  .concept-card.opened .cc-check { color: var(--success); }
  .concept-card-body {
    display: none;
    padding: 0 1.2rem 1.2rem;
    font-size: 0.9rem;
    line-height: 1.75;
    border-top: 1px solid var(--border);
    padding-top: 1rem;
  }
  .concept-card.open .concept-card-body { display: block; animation: fadeIn 0.3s; }

  /* QUIZ (Phase 4) */
  .quiz-question {
    background: var(--card-bg);
    border-radius: var(--radius);
    border: 2px solid var(--border);
    padding: 1.2rem;
    margin-bottom: 1rem;
    transition: border-color 0.3s;
  }
  .quiz-question.correct { border-color: var(--success); }
  .quiz-question.wrong { border-color: var(--error); }
  .quiz-question.missing { border-color: var(--warning); animation: pulse 0.6s; }

  @keyframes pulse {
    0%, 100% { box-shadow: none; }
    50% { box-shadow: 0 0 0 4px rgba(243, 156, 18, 0.25); }
  }

  .qq-number {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--primary-light);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 0.4rem;
  }
  .qq-text {
    font-size: 0.95rem;
    font-weight: 600;
    margin-bottom: 0.8rem;
    line-height: 1.6;
  }
  .qq-options { display: flex; flex-direction: column; gap: 0.4rem; }
  .qq-option {
    display: flex;
    align-items: center;
    gap: 0.7rem;
    padding: 0.6rem 0.9rem;
    border: 2px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
  }
  .qq-option:hover { border-color: var(--primary-light); background: #f0f6fc; }
  .qq-option.selected { border-color: var(--primary); background: #e8f0fe; }
  .qq-option.locked { pointer-events: none; }
  .qq-option.correct-answer { border-color: var(--success); background: var(--success-bg); }
  .qq-option.wrong-answer { border-color: var(--error); background: var(--error-bg); }
  .qq-option input { display: none; }
  .qq-radio {
    width: 18px; height: 18px;
    border-radius: 50%;
    border: 2px solid var(--border);
    flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
  }
  .qq-option.selected .qq-radio {
    border-color: var(--primary);
    background: var(--primary);
  }
  .qq-option.selected .qq-radio::after {
    content: '';
    width: 6px; height: 6px;
    background: white;
    border-radius: 50%;
  }

  .qq-feedback {
    display: none;
    margin-top: 0.8rem;
    padding: 0.7rem 0.9rem;
    border-radius: 8px;
    font-size: 0.85rem;
    line-height: 1.6;
  }
  .qq-feedback.show { display: block; animation: fadeIn 0.3s; }
  .qq-feedback.correct { background: var(--success-bg); color: #1e7e3e; }
  .qq-feedback.wrong { background: var(--error-bg); color: #c0392b; }

  /* BUTTONS */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-family: inherit;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.25s;
  }
  .btn-primary { background: var(--primary); color: white; }
  .btn-primary:hover { background: #154360; transform: translateY(-1px); box-shadow: var(--shadow); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
  .btn-secondary { background: var(--border); color: var(--text); }
  .btn-secondary:hover { background: #d5dbe2; }
  .btn-success { background: var(--success); color: white; }
  .btn-success:hover { background: #219a52; }

  .btn-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.8rem;
    margin-top: 1.5rem;
    justify-content: center;
  }

  /* REVIEW (Phase 5) */
  .review-score {
    text-align: center;
    padding: 2rem 1.5rem;
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
  }
  .review-score .score-number {
    font-family: 'DM Serif Display', serif;
    font-size: 3.5rem;
    color: var(--primary);
    line-height: 1;
  }
  .review-score .score-label {
    font-size: 0.9rem;
    color: var(--text-light);
    margin-top: 0.3rem;
  }
  .review-score .score-message {
    font-size: 1rem;
    font-weight: 600;
    margin-top: 0.8rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    display: inline-block;
  }

  .review-area {
    border-radius: var(--radius);
    padding: 1.2rem;
    margin-bottom: 1rem;
  }
  .review-area.needs-review {
    background: var(--warning-bg);
    border-left: 4px solid var(--warning);
  }
  .review-area.good {
    background: var(--success-bg);
    border-left: 4px solid var(--success);
  }
  .review-area h3 {
    font-size: 0.95rem;
    margin-bottom: 0.5rem;
  }
  .review-area .review-tag {
    display: inline-block;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 0.15rem 0.5rem;
    border-radius: 4px;
    margin-bottom: 0.5rem;
  }
  .review-area.needs-review .review-tag { background: var(--warning); color: white; }
  .review-area.good .review-tag { background: var(--success); color: white; }
  .review-area p { font-size: 0.88rem; }

  /* PRINT */
  @media print {
    [id^="phase"] { display: none !important; }
    #phase5 { display: block !important; }
    .header, .progress-container, .btn, .btn-row { display: none !important; }
    body { background: white; }
    .review-area { break-inside: avoid; }
  }

  /* MOBILE */
  @media (max-width: 600px) {
    .header { padding: 1.5rem 1rem 1.2rem; }
    .main { padding: 1rem; }
    .angle-grid { grid-template-columns: 1fr; }
    .progress-step span { display: none; }
  }
</style>
</head>
<body>

<div class="header">
  <h1>Angoli formati da due rette tagliate da una trasversale</h1>
  <p>Percorso didattico interattivo</p>
</div>

<div class="progress-container">
  <div class="progress-steps" id="progressSteps">
    <div class="progress-step active" data-step="1"><div class="step-num">1</div><span>Configurazione</span></div>
    <div class="step-connector"></div>
    <div class="progress-step" data-step="2"><div class="step-num">2</div><span>Le quattro coppie</span></div>
    <div class="step-connector"></div>
    <div class="progress-step" data-step="3"><div class="step-num">3</div><span>Concetti chiave</span></div>
    <div class="step-connector"></div>
    <div class="progress-step" data-step="4"><div class="step-num">4</div><span>Verifica</span></div>
    <div class="step-connector"></div>
    <div class="progress-step" data-step="5"><div class="step-num">5</div><span>Ripasso</span></div>
  </div>
</div>

<div class="main">

<!-- ========== PHASE 1: Configurazione e Opposti al Vertice ========== -->
<div class="phase active" id="phase1">
  <h2 class="phase-title">Configurazione e opposti al vertice</h2>
  <p class="phase-subtitle">Scopri come si formano gli 8 angoli e la prima relazione fondamentale.</p>

  <div class="instruction">üìê Clicca su ogni elemento per scoprirne le propriet√†. Devi aprirli tutti per proseguire.</div>

  <div class="diagram-container">
    <svg viewBox="0 0 560 340" width="520" xmlns="http://www.w3.org/2000/svg">
      <!-- zona interna -->
      <rect x="0" y="115" width="560" height="110" fill="#eef6fc" opacity="0.5"/>
      <text x="480" y="174" font-size="11" fill="#2980b9" font-family="DM Sans, sans-serif" font-weight="600">zona interna</text>
      <!-- retta r -->
      <line x1="30" y1="115" x2="530" y2="115" stroke="#2c3e50" stroke-width="2"/>
      <text x="535" y="119" font-size="14" fill="#2c3e50" font-family="DM Sans, sans-serif" font-style="italic" font-weight="700">r</text>
      <!-- retta s -->
      <line x1="30" y1="225" x2="530" y2="225" stroke="#2c3e50" stroke-width="2"/>
      <text x="535" y="229" font-size="14" fill="#2c3e50" font-family="DM Sans, sans-serif" font-style="italic" font-weight="700">s</text>
      <!-- trasversale t (da 150,20 a 380,310) -->
      <line x1="150" y1="20" x2="380" y2="310" stroke="#e74c3c" stroke-width="2.5"/>
      <text x="140" y="18" font-size="14" fill="#e74c3c" font-family="DM Sans, sans-serif" font-style="italic" font-weight="700">t</text>
      <!-- punto P (225, 115) -->
      <circle cx="225" cy="115" r="4" fill="#1a5276"/>
      <text x="168" y="108" font-size="13" fill="#1a5276" font-family="DM Sans, sans-serif" font-weight="700">P</text>
      <!-- angoli in P -->
      <text x="240" y="105" font-size="15" fill="#e74c3c" font-family="DM Sans, sans-serif" font-weight="700">1</text>
      <text x="196" y="105" font-size="15" fill="#2980b9" font-family="DM Sans, sans-serif" font-weight="700">2</text>
      <text x="196" y="140" font-size="15" fill="#27ae60" font-family="DM Sans, sans-serif" font-weight="700">3</text>
      <text x="240" y="140" font-size="15" fill="#f39c12" font-family="DM Sans, sans-serif" font-weight="700">4</text>
      <!-- punto Q (313, 225) -->
      <circle cx="313" cy="225" r="4" fill="#1a5276"/>
      <text x="255" y="218" font-size="13" fill="#1a5276" font-family="DM Sans, sans-serif" font-weight="700">Q</text>
      <!-- angoli in Q -->
      <text x="283" y="250" font-size="15" fill="#27ae60" font-family="DM Sans, sans-serif" font-weight="700">5</text>
      <text x="327" y="250" font-size="15" fill="#f39c12" font-family="DM Sans, sans-serif" font-weight="700">6</text>
      <text x="327" y="215" font-size="15" fill="#e74c3c" font-family="DM Sans, sans-serif" font-weight="700">7</text>
      <text x="283" y="215" font-size="15" fill="#2980b9" font-family="DM Sans, sans-serif" font-weight="700">8</text>
    </svg>
  </div>

  <div class="angle-grid" id="phase1Grid">
    <div class="angle-card" data-card="p1-config" onclick="openCard(this)">
      <div class="angle-card-header">
        <span class="card-label">üìê La configurazione base</span>
        <span class="card-icon">‚û§</span>
      </div>
      <div class="angle-card-body">
        <p>Due rette <span class="highlight">r</span> e <span class="highlight">s</span> vengono tagliate da una retta <span class="highlight">t</span>, detta <strong>trasversale</strong>.</p>
        <p>La trasversale interseca <em>r</em> nel punto <strong>P</strong> e <em>s</em> nel punto <strong>Q</strong>. In ogni punto di intersezione si formano <strong>4 angoli</strong>, per un totale di <strong>8 angoli</strong>.</p>
        <div class="formula-box">
          La zona compresa tra <em>r</em> e <em>s</em> √® la <strong>zona interna</strong>.<br>
          La zona fuori da <em>r</em> e <em>s</em> √® la <strong>zona esterna</strong>.
        </div>
      </div>
    </div>

    <div class="angle-card" data-card="p1-nomi" onclick="openCard(this)">
      <div class="angle-card-header">
        <span class="card-label">üî¢ Numerazione degli angoli</span>
        <span class="card-icon">‚û§</span>
      </div>
      <div class="angle-card-body">
        <p>Nel punto <strong>P</strong> (su <em>r</em>) si formano gli angoli numerati da <strong>1 a 4</strong>.</p>
        <p>Nel punto <strong>Q</strong> (su <em>s</em>) si formano gli angoli numerati da <strong>5 a 8</strong>.</p>
        <div class="formula-box">
          Angoli nella zona <strong>interna</strong>: 3, 4 (in P) e 5, 6 (in Q).<br>
          Angoli nella zona <strong>esterna</strong>: 1, 2 (in P) e 7, 8 (in Q).
        </div>
      </div>
    </div>

    <div class="angle-card" data-card="p1-opposti" onclick="openCard(this)">
      <div class="angle-card-header">
        <span class="card-label">üîÑ Opposti al vertice</span>
        <span class="card-icon">‚û§</span>
      </div>
      <div class="angle-card-body">
        <p>Due angoli sono <strong>opposti al vertice</strong> quando hanno lo stesso vertice e i lati dell'uno sono i prolungamenti dei lati dell'altro.</p>
        <p>Sono <strong class="highlight">sempre congruenti</strong>, anche se le rette <em>non</em> sono parallele.</p>
        <div class="formula-box" id="opposti-formulas"></div>
      </div>
    </div>

    <div class="angle-card" data-card="p1-importante" onclick="openCard(this)">
      <div class="angle-card-header">
        <span class="card-label">‚ö° Perch√© sono importanti</span>
        <span class="card-icon">‚û§</span>
      </div>
      <div class="angle-card-body">
        <p>Gli angoli opposti al vertice sono l'unica relazione che <strong>non richiede il parallelismo</strong> tra <em>r</em> e <em>s</em>.</p>
        <p>In ogni intersezione tra due rette ‚Äî parallele o no ‚Äî gli angoli opposti al vertice sono congruenti. Questa propriet√† vale <strong>sempre</strong>.</p>
      </div>
    </div>
  </div>

  <div class="btn-row">
    <button class="btn btn-primary" id="btnNext1" disabled onclick="goToPhase(2)">Prosegui ‚û§</button>
  </div>
</div>

<!-- ========== PHASE 2: Le quattro coppie di angoli ========== -->
<div class="phase" id="phase2">
  <h2 class="phase-title">Le quattro coppie di angoli</h2>
  <p class="phase-subtitle">Scopri le relazioni tra gli angoli quando le rette sono parallele.</p>

  <div class="instruction">üìê Clicca su ogni coppia per scoprirne le propriet√†. Devi aprirle tutte per proseguire.</div>

  <div class="angle-grid" id="phase2Grid">
    <div class="angle-card" data-card="p2-altint" onclick="openCard(this)">
      <div class="angle-card-header">
        <span class="card-label">‚óÜ Alterni interni</span>
        <span class="card-icon">‚û§</span>
      </div>
      <div class="angle-card-body">
        <p>Si trovano nella <strong>zona interna</strong>, su <strong>lati opposti</strong> della trasversale.</p>
        <div class="formula-box" id="altint-formulas"></div>
        <p>Se <em>r</em> ‚à• <em>s</em>, sono <strong class="highlight">congruenti</strong>.</p>
      </div>
    </div>

    <div class="angle-card" data-card="p2-altext" onclick="openCard(this)">
      <div class="angle-card-header">
        <span class="card-label">‚óá Alterni esterni</span>
        <span class="card-icon">‚û§</span>
      </div>
      <div class="angle-card-body">
        <p>Si trovano nella <strong>zona esterna</strong>, su <strong>lati opposti</strong> della trasversale.</p>
        <div class="formula-box" id="altext-formulas"></div>
        <p>Se <em>r</em> ‚à• <em>s</em>, sono <strong class="highlight">congruenti</strong>.</p>
      </div>
    </div>

    <div class="angle-card" data-card="p2-corrisp" onclick="openCard(this)">
      <div class="angle-card-header">
        <span class="card-label">‚óè Corrispondenti</span>
        <span class="card-icon">‚û§</span>
      </div>
      <div class="angle-card-body">
        <p>Si trovano dalla <strong>stessa parte</strong> della trasversale, nella <strong>stessa posizione</strong> rispetto al proprio punto di intersezione.</p>
        <div class="formula-box" id="corrisp-formulas"></div>
        <p>Se <em>r</em> ‚à• <em>s</em>, sono <strong class="highlight">congruenti</strong>. Sono 4 coppie in totale.</p>
      </div>
    </div>

    <div class="angle-card" data-card="p2-coniug" onclick="openCard(this)">
      <div class="angle-card-header">
        <span class="card-label">‚òÖ Coniugati interni</span>
        <span class="card-icon">‚û§</span>
      </div>
      <div class="angle-card-body">
        <p>Si trovano nella <strong>zona interna</strong>, dalla <strong>stessa parte</strong> della trasversale.</p>
        <div class="formula-box" id="coniug-formulas"></div>
        <p>Se <em>r</em> ‚à• <em>s</em>, sono <strong class="highlight">supplementari</strong>: la loro somma √® 180¬∞.</p>
        <p>‚ö° <strong>Attenzione:</strong> sono l'unica coppia che <em>non</em> √® congruente!</p>
      </div>
    </div>
  </div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="goToPhase(1)">‚Üê Indietro</button>
    <button class="btn btn-primary" id="btnNext2" disabled onclick="goToPhase(3)">Prosegui ‚û§</button>
  </div>
</div>

<!-- ========== PHASE 3: Concetti chiave ========== -->
<div class="phase" id="phase3">
  <h2 class="phase-title">Concetti chiave</h2>
  <p class="phase-subtitle">Approfondisci le propriet√†, le formule e i casi particolari.</p>

  <div class="instruction">üìê Clicca sull'intestazione di ogni card per espanderla. Devi aprirle tutte per proseguire.</div>

  <div id="phase3Cards">
    <div class="concept-card" data-card="p3-riepilogo">
      <div class="concept-card-header" onclick="toggleConcept(this.parentElement)">
        <span class="cc-label">üìã Riepilogo ‚Äî Se r ‚à• s</span>
        <span class="cc-arrow">‚ñº</span>
      </div>
      <div class="concept-card-body" id="p3-riepilogo-body">
      </div>
    </div>

    <div class="concept-card" data-card="p3-differenza">
      <div class="concept-card-header" onclick="toggleConcept(this.parentElement)">
        <span class="cc-label">‚óÜ Alterni vs Corrispondenti: come distinguerli</span>
        <span class="cc-arrow">‚ñº</span>
      </div>
      <div class="concept-card-body">
        <p>La differenza fondamentale √® la <strong>posizione rispetto alla trasversale</strong>:</p>
        <p>Gli angoli <strong>alterni</strong> stanno su <strong>lati opposti</strong> della trasversale <em>t</em>: uno a destra e uno a sinistra.</p>
        <p>Gli angoli <strong>corrispondenti</strong> stanno dalla <strong>stessa parte</strong> della trasversale: entrambi a destra o entrambi a sinistra, ma uno in P e l'altro in Q nella stessa posizione.</p>
        <div class="formula-box">
          ‚û§ <strong>Trucco:</strong> guarda sempre la posizione rispetto alla trasversale, non rispetto alle rette!
        </div>
      </div>
    </div>

    <div class="concept-card" data-card="p3-coniugati">
      <div class="concept-card-header" onclick="toggleConcept(this.parentElement)">
        <span class="cc-label">‚òÖ Perch√© i coniugati non sono congruenti</span>
        <span class="cc-arrow">‚ñº</span>
      </div>
      <div class="concept-card-body" id="p3-coniugati-body">
      </div>
    </div>

    <div class="concept-card" data-card="p3-senza-par">
      <div class="concept-card-header" onclick="toggleConcept(this.parentElement)">
        <span class="cc-label">‚ö° Cosa succede senza parallelismo</span>
        <span class="cc-arrow">‚ñº</span>
      </div>
      <div class="concept-card-body">
        <p>Se <em>r</em> e <em>s</em> <strong>non</strong> sono parallele, le propriet√† di congruenza e supplementarit√† degli alterni, corrispondenti e coniugati <strong>non valgono</strong>.</p>
        <p>L'unica relazione che resta <strong>sempre vera</strong> √® quella degli <strong>opposti al vertice</strong>: in qualsiasi intersezione, gli opposti al vertice sono congruenti.</p>
        <div class="formula-box">
          ‚û§ Opposti al vertice = congruenti <strong>sempre</strong><br>
          ‚û§ Tutte le altre coppie = propriet√† valide <strong>solo se r ‚à• s</strong>
        </div>
      </div>
    </div>

    <div class="concept-card" data-card="p3-errori">
      <div class="concept-card-header" onclick="toggleConcept(this.parentElement)">
        <span class="cc-label">‚ö† Errori comuni</span>
        <span class="cc-arrow">‚ñº</span>
      </div>
      <div class="concept-card-body">
        <p><strong>1. Confondere alterni e corrispondenti.</strong> Ricorda: gli alterni stanno su lati opposti di <em>t</em>, i corrispondenti sulla stessa parte. Guarda sempre la posizione rispetto alla trasversale.</p>
        <p><strong>2. Pensare che i coniugati siano congruenti.</strong> Sono l'unica coppia che non √® congruente: la loro somma fa 180¬∞, sono supplementari.</p>
        <p><strong>3. Dimenticare gli opposti al vertice.</strong> Sono congruenti sempre, anche senza parallelismo. Vale in qualsiasi intersezione.</p>
      </div>
    </div>
  </div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="goToPhase(2)">‚Üê Indietro</button>
    <button class="btn btn-primary" id="btnNext3" disabled onclick="goToPhase(4)">Vai alla Verifica ‚û§</button>
  </div>
</div>

<!-- ========== PHASE 4: Verifica ========== -->
<div class="phase" id="phase4">
  <h2 class="phase-title">Verifica</h2>
  <p class="phase-subtitle">Metti alla prova quello che hai imparato.</p>

  <div id="quizContainer"></div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="goToPhase(3)">‚Üê Indietro</button>
    <button class="btn btn-primary" id="btnVerify" onclick="verifyQuiz()">Verifica Risposte</button>
  </div>
</div>

<!-- ========== PHASE 5: Ripasso ========== -->
<div class="phase" id="phase5">
  <h2 class="phase-title">Ripasso personalizzato</h2>
  <p class="phase-subtitle">Rivedi le aree in base ai tuoi risultati.</p>

  <div class="review-score" id="reviewScore"></div>
  <div id="reviewContent"></div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="goToPhase(4)">‚Üê Rivedi Errori</button>
    <button class="btn btn-primary" onclick="window.print()">üñ® Stampa Ripasso</button>
    <button class="btn btn-success" onclick="restart()">üîÑ Ricomincia</button>
  </div>
</div>

</div><!-- /main -->

<script>
// ============================================
// STATE
// ============================================
const state = {
  phase: 1,
  opened: { phase1: new Set(), phase2: new Set(), phase3: new Set() },
  required: {
    phase1: ['p1-config','p1-nomi','p1-opposti','p1-importante'],
    phase2: ['p2-altint','p2-altext','p2-corrisp','p2-coniug'],
    phase3: ['p3-riepilogo','p3-differenza','p3-coniugati','p3-senza-par','p3-errori']
  },
  quizAnswers: {},
  quizVerified: false
};

// ============================================
// KATEX RENDERING
// ============================================
function renderKatex() {
  // Phase 1: Opposti al vertice
  const opposti = document.getElementById('opposti-formulas');
  if (opposti) {
    opposti.innerHTML = `
      In P: ${k('\\widehat{1} \\cong \\widehat{3}')} , ${k('\\widehat{2} \\cong \\widehat{4}')}<br>
      In Q: ${k('\\widehat{5} \\cong \\widehat{7}')} , ${k('\\widehat{6} \\cong \\widehat{8}')}
    `;
  }
  // Phase 2
  const altint = document.getElementById('altint-formulas');
  if (altint) {
    altint.innerHTML = `Coppie: ${k('\\widehat{3}')} e ${k('\\widehat{5}')} ; ${k('\\widehat{4}')} e ${k('\\widehat{6}')}<br>
    Se ${k('r \\parallel s')}: ${k('\\widehat{3} \\cong \\widehat{5}')} , ${k('\\widehat{4} \\cong \\widehat{6}')}`;
  }
  const altext = document.getElementById('altext-formulas');
  if (altext) {
    altext.innerHTML = `Coppie: ${k('\\widehat{1}')} e ${k('\\widehat{7}')} ; ${k('\\widehat{2}')} e ${k('\\widehat{8}')}<br>
    Se ${k('r \\parallel s')}: ${k('\\widehat{1} \\cong \\widehat{7}')} , ${k('\\widehat{2} \\cong \\widehat{8}')}`;
  }
  const corrisp = document.getElementById('corrisp-formulas');
  if (corrisp) {
    corrisp.innerHTML = `Coppie: ${k('\\widehat{1}')}‚Äì${k('\\widehat{5}')} ; ${k('\\widehat{2}')}‚Äì${k('\\widehat{6}')} ; ${k('\\widehat{3}')}‚Äì${k('\\widehat{7}')} ; ${k('\\widehat{4}')}‚Äì${k('\\widehat{8}')}<br>
    Se ${k('r \\parallel s')}: tutte e 4 le coppie congruenti.`;
  }
  const coniug = document.getElementById('coniug-formulas');
  if (coniug) {
    coniug.innerHTML = `Coppie: ${k('\\widehat{3}')} e ${k('\\widehat{6}')} ; ${k('\\widehat{4}')} e ${k('\\widehat{5}')}<br>
    Se ${k('r \\parallel s')}: ${k('\\widehat{3} + \\widehat{6} = 180¬∞')} , ${k('\\widehat{4} + \\widehat{5} = 180¬∞')}`;
  }
  // Phase 3: Riepilogo
  const riep = document.getElementById('p3-riepilogo-body');
  if (riep) {
    riep.innerHTML = `
      <p>Quando le rette <em>r</em> e <em>s</em> sono <strong>parallele</strong>, valgono queste propriet√†:</p>
      <div class="formula-box">
        ‚û§ Opposti al vertice ‚Üí <strong>congruenti</strong> (sempre, anche senza parallelismo)<br>
        ‚û§ Alterni interni ‚Üí <strong>congruenti</strong><br>
        ‚û§ Alterni esterni ‚Üí <strong>congruenti</strong><br>
        ‚û§ Corrispondenti ‚Üí <strong>congruenti</strong><br>
        ‚û§ Coniugati interni ‚Üí <strong>supplementari</strong> (somma = 180¬∞)
      </div>
    `;
  }
  // Phase 3: Coniugati
  const conj = document.getElementById('p3-coniugati-body');
  if (conj) {
    conj.innerHTML = `
      <p>I coniugati interni stanno nella zona interna, dalla <strong>stessa parte</strong> della trasversale.</p>
      <p>Esempio: ${k('\\widehat{3}')} e ${k('\\widehat{6}')} sono entrambi nella zona interna, entrambi a sinistra di <em>t</em>.</p>
      <p>Se ${k('r \\parallel s')}, la loro somma √® ${k('180¬∞')}. Non sono congruenti tra loro (a meno che non siano entrambi di ${k('90¬∞')}).</p>
      <div class="formula-box">
        Esempio numerico: se ${k('\\widehat{3} = 60¬∞')}, allora ${k('\\widehat{6} = 120¬∞')} perch√© ${k('60¬∞ + 120¬∞ = 180¬∞')}.
      </div>
    `;
  }
}

function k(tex) {
  try {
    return katex.renderToString(tex, { throwOnError: false, displayMode: false });
  } catch(e) { return tex; }
}

// ============================================
// CARD INTERACTIONS
// ============================================
function openCard(el) {
  const cardId = el.dataset.card;
  el.classList.add('opened');

  const phaseKey = cardId.startsWith('p1-') ? 'phase1' : 'phase2';
  state.opened[phaseKey].add(cardId);
  checkPhaseComplete(phaseKey);
}

function toggleConcept(el) {
  const wasOpen = el.classList.contains('open');
  el.classList.toggle('open');
  if (!wasOpen) {
    el.classList.add('opened');
    state.opened.phase3.add(el.dataset.card);
    checkPhaseComplete('phase3');
  }
}

function checkPhaseComplete(phaseKey) {
  const required = state.required[phaseKey];
  const opened = state.opened[phaseKey];
  const allOpened = required.every(id => opened.has(id));

  const phaseNum = phaseKey.replace('phase','');
  const btn = document.getElementById('btnNext' + phaseNum);
  if (btn) btn.disabled = !allOpened;
}

// ============================================
// NAVIGATION
// ============================================
function goToPhase(n) {
  document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
  document.getElementById('phase' + n).classList.add('active');
  state.phase = n;
  updateProgress();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updateProgress() {
  document.querySelectorAll('.progress-step').forEach(s => {
    const step = parseInt(s.dataset.step);
    s.classList.remove('active', 'completed');
    if (step === state.phase) s.classList.add('active');
    else if (step < state.phase) s.classList.add('completed');
  });
}

// ============================================
// QUIZ
// ============================================
const quizData = [
  {
    category: 'configurazione',
    q: 'Quanti angoli si formano in totale quando una trasversale taglia due rette?',
    options: ['4','6','8','10'],
    correct: 2,
    explanation: 'In ogni punto di intersezione si formano 4 angoli; con 2 punti di intersezione, il totale √® 8.'
  },
  {
    category: 'configurazione',
    q: 'Gli angoli 3, 4, 5 e 6 si trovano nella...',
    options: ['zona esterna','zona interna','zona laterale','zona di intersezione'],
    correct: 1,
    explanation: 'La zona interna √® quella compresa tra le due rette r e s. Gli angoli 3 e 4 sono in P verso l\'interno, 5 e 6 sono in Q verso l\'interno.'
  },
  {
    category: 'opposti',
    q: 'Gli angoli opposti al vertice sono congruenti...',
    options: ['solo se le rette sono parallele','solo se le rette sono perpendicolari','sempre, in qualsiasi intersezione','mai, servono condizioni aggiuntive'],
    correct: 2,
    explanation: 'Gli opposti al vertice sono sempre congruenti, indipendentemente dal parallelismo. √à l\'unica relazione che non richiede rette parallele.'
  },
  {
    category: 'alterni',
    q: 'Gli angoli alterni interni si trovano...',
    options: ['nella zona interna, dalla stessa parte della trasversale','nella zona esterna, su lati opposti della trasversale','nella zona interna, su lati opposti della trasversale','nella zona esterna, dalla stessa parte della trasversale'],
    correct: 2,
    explanation: 'Gli alterni interni stanno nella zona interna e su lati opposti della trasversale: uno a destra e uno a sinistra di t.'
  },
  {
    category: 'alterni',
    q: 'Se r ‚à• s, quale coppia √® formata da angoli alterni esterni?',
    options: ['3 e 5','1 e 7','3 e 6','1 e 5'],
    correct: 1,
    explanation: 'L\'angolo 1 √® in zona esterna (sopra r) e l\'angolo 7 √® in zona esterna (sotto s), su lati opposti della trasversale.'
  },
  {
    category: 'corrispondenti',
    q: 'Quante coppie di angoli corrispondenti ci sono?',
    options: ['2','3','4','8'],
    correct: 2,
    explanation: 'Le coppie di corrispondenti sono 4: 1‚Äì5, 2‚Äì6, 3‚Äì7, 4‚Äì8. Ogni angolo in P ha un corrispondente in Q nella stessa posizione.'
  },
  {
    category: 'corrispondenti',
    q: 'I corrispondenti stanno...',
    options: ['su lati opposti della trasversale','nella stessa zona','dalla stessa parte della trasversale, nella stessa posizione','nella zona interna'],
    correct: 2,
    explanation: 'I corrispondenti si trovano dalla stessa parte della trasversale e occupano la stessa posizione rispetto al proprio punto di intersezione.'
  },
  {
    category: 'coniugati',
    q: 'Se r ‚à• s, i coniugati interni sono...',
    options: ['congruenti','complementari','supplementari','opposti'],
    correct: 2,
    explanation: 'I coniugati interni sono supplementari: la loro somma √® 180¬∞. Sono l\'unica coppia che non √® congruente.'
  },
  {
    category: 'coniugati',
    q: 'Se r ‚à• s e l\'angolo 3 misura 70¬∞, quanto misura l\'angolo 6?',
    options: ['70¬∞','90¬∞','110¬∞','180¬∞'],
    correct: 2,
    explanation: '3 e 6 sono coniugati interni: la loro somma √® 180¬∞. Quindi l\'angolo 6 = 180¬∞ ‚àí 70¬∞ = 110¬∞.'
  },
  {
    category: 'errori',
    q: 'Quale affermazione √® FALSA?',
    options: [
      'Gli alterni interni sono congruenti se r ‚à• s',
      'I coniugati interni sono congruenti se r ‚à• s',
      'Gli opposti al vertice sono congruenti sempre',
      'I corrispondenti sono congruenti se r ‚à• s'
    ],
    correct: 1,
    explanation: 'I coniugati interni NON sono congruenti: sono supplementari (la loro somma √® 180¬∞). √à l\'errore pi√π comune!'
  }
];

function buildQuiz() {
  const container = document.getElementById('quizContainer');
  container.innerHTML = '';
  quizData.forEach((item, i) => {
    const div = document.createElement('div');
    div.className = 'quiz-question';
    div.id = 'qq-' + i;
    div.innerHTML = `
      <div class="qq-number">Domanda ${i+1} di ${quizData.length} ‚Äî ${getCategoryLabel(item.category)}</div>
      <div class="qq-text">${item.q}</div>
      <div class="qq-options">
        ${item.options.map((opt, j) => `
          <label class="qq-option" onclick="selectOption(${i}, ${j}, this)">
            <input type="radio" name="q${i}" value="${j}">
            <span class="qq-radio"></span>
            <span>${opt}</span>
          </label>
        `).join('')}
      </div>
      <div class="qq-feedback" id="feedback-${i}"></div>
    `;
    container.appendChild(div);
  });
}

function getCategoryLabel(cat) {
  const labels = {
    configurazione: 'üìê Configurazione',
    opposti: 'üîÑ Opposti al vertice',
    alterni: '‚óÜ Alterni',
    corrispondenti: '‚óè Corrispondenti',
    coniugati: '‚òÖ Coniugati',
    errori: '‚ö† Errori comuni'
  };
  return labels[cat] || cat;
}

function selectOption(qIdx, optIdx, el) {
  if (state.quizVerified) return;
  const question = document.getElementById('qq-' + qIdx);
  question.querySelectorAll('.qq-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  state.quizAnswers[qIdx] = optIdx;
}

function verifyQuiz() {
  if (state.quizVerified) {
    goToPhase(5);
    return;
  }

  // Check all answered
  const unanswered = [];
  quizData.forEach((_, i) => {
    const qq = document.getElementById('qq-' + i);
    qq.classList.remove('missing');
    if (state.quizAnswers[i] === undefined) {
      unanswered.push(i);
      qq.classList.add('missing');
    }
  });

  if (unanswered.length > 0) {
    document.getElementById('qq-' + unanswered[0]).scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  // Grade
  state.quizVerified = true;
  let score = 0;
  quizData.forEach((item, i) => {
    const qq = document.getElementById('qq-' + i);
    const isCorrect = state.quizAnswers[i] === item.correct;
    if (isCorrect) score++;

    qq.classList.add(isCorrect ? 'correct' : 'wrong');
    qq.querySelectorAll('.qq-option').forEach((opt, j) => {
      opt.classList.add('locked');
      if (j === item.correct) opt.classList.add('correct-answer');
      if (j === state.quizAnswers[i] && !isCorrect) opt.classList.add('wrong-answer');
    });

    const fb = document.getElementById('feedback-' + i);
    fb.className = 'qq-feedback show ' + (isCorrect ? 'correct' : 'wrong');
    fb.innerHTML = isCorrect
      ? '‚úî Corretto! ' + item.explanation
      : '‚úò Non corretto. ' + item.explanation;
  });

  state.score = score;
  state.total = quizData.length;

  const btn = document.getElementById('btnVerify');
  btn.textContent = 'Vai al Ripasso ‚û§';
  btn.className = 'btn btn-success';

  buildReview();
}

// ============================================
// REVIEW
// ============================================
function buildReview() {
  const { score, total } = state;
  const pct = Math.round((score / total) * 100);

  let message, msgColor;
  if (pct >= 90) { message = 'Hai capito bene!'; msgColor = '#27ae60'; }
  else if (pct >= 60) { message = 'Ci sei quasi, rivedi le aree evidenziate.'; msgColor = '#f39c12'; }
  else { message = 'Da rivedere con attenzione.'; msgColor = '#e74c3c'; }

  document.getElementById('reviewScore').innerHTML = `
    <div class="score-number">${score}/${total}</div>
    <div class="score-label">${pct}% di risposte corrette</div>
    <div class="score-message" style="background: ${msgColor}15; color: ${msgColor}">${message}</div>
  `;

  // Group by category
  const categories = {};
  quizData.forEach((item, i) => {
    if (!categories[item.category]) categories[item.category] = { correct: 0, total: 0 };
    categories[item.category].total++;
    if (state.quizAnswers[i] === item.correct) categories[item.category].correct++;
  });

  const reviewContent = document.getElementById('reviewContent');
  reviewContent.innerHTML = '';

  const reviewData = {
    configurazione: {
      title: 'üìê Configurazione',
      review: 'Due rette r e s tagliate da una trasversale t formano 8 angoli: 4 nel punto P (su r) e 4 nel punto Q (su s). La zona tra le rette √® la zona interna (angoli 3, 4, 5, 6), quella fuori √® la zona esterna (angoli 1, 2, 7, 8).',
      summary: 'La configurazione base con 8 angoli, zona interna e zona esterna.'
    },
    opposti: {
      title: 'üîÑ Opposti al vertice',
      review: 'Gli angoli opposti al vertice hanno lo stesso vertice e i lati dell\'uno sono i prolungamenti dei lati dell\'altro. Sono SEMPRE congruenti, anche senza parallelismo. Sono l\'unica relazione che non dipende dal parallelismo.',
      summary: 'Opposti al vertice: congruenti sempre.'
    },
    alterni: {
      title: '‚óÜ Alterni (interni ed esterni)',
      review: 'Gli alterni interni (3‚Äì5, 4‚Äì6) si trovano nella zona interna su lati opposti della trasversale. Gli alterni esterni (1‚Äì7, 2‚Äì8) nella zona esterna su lati opposti. Se r ‚à• s, entrambi i tipi sono congruenti. Parola chiave: lati OPPOSTI della trasversale.',
      summary: 'Alterni: lati opposti di t, congruenti se r ‚à• s.'
    },
    corrispondenti: {
      title: '‚óè Corrispondenti',
      review: 'I corrispondenti (1‚Äì5, 2‚Äì6, 3‚Äì7, 4‚Äì8) stanno dalla stessa parte della trasversale nella stessa posizione rispetto al punto. Sono 4 coppie. Se r ‚à• s, sono congruenti. Parola chiave: stessa PARTE e stessa POSIZIONE.',
      summary: 'Corrispondenti: stessa parte di t, stessa posizione, congruenti se r ‚à• s.'
    },
    coniugati: {
      title: '‚òÖ Coniugati interni',
      review: 'I coniugati interni (3‚Äì6, 4‚Äì5) sono nella zona interna dalla STESSA parte della trasversale. Se r ‚à• s, sono supplementari (somma = 180¬∞). ATTENZIONE: sono l\'unica coppia che NON √® congruente! Esempio: se l\'angolo 3 = 70¬∞, l\'angolo 6 = 110¬∞.',
      summary: 'Coniugati interni: supplementari, NON congruenti.'
    },
    errori: {
      title: '‚ö† Errori comuni',
      review: '1) Non confondere alterni (lati opposti) e corrispondenti (stessa parte). 2) I coniugati NON sono congruenti, sono supplementari. 3) Gli opposti al vertice sono congruenti SEMPRE, non serve il parallelismo.',
      summary: 'Le trappole principali da evitare.'
    }
  };

  for (const [cat, data] of Object.entries(categories)) {
    const info = reviewData[cat];
    const isGood = data.correct === data.total;
    const div = document.createElement('div');
    div.className = 'review-area ' + (isGood ? 'good' : 'needs-review');
    div.innerHTML = `
      <span class="review-tag">${isGood ? 'Hai capito bene' : 'Da rivedere'}</span>
      <h3>${info.title} (${data.correct}/${data.total})</h3>
      <p>${isGood ? info.summary : info.review}</p>
    `;
    reviewContent.appendChild(div);
  }
}

// ============================================
// RESTART
// ============================================
function restart() {
  state.phase = 1;
  state.opened = { phase1: new Set(), phase2: new Set(), phase3: new Set() };
  state.quizAnswers = {};
  state.quizVerified = false;

  // Reset cards
  document.querySelectorAll('.angle-card, .concept-card').forEach(c => {
    c.classList.remove('opened', 'open');
  });
  document.querySelectorAll('[id^="btnNext"]').forEach(b => b.disabled = true);

  buildQuiz();
  goToPhase(1);
}

// ============================================
// INIT
// ============================================
document.addEventListener('DOMContentLoaded', () => {
  renderKatex();
  buildQuiz();
});
</script>

</body>
</html>
