<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Prodotti Notevoli - Percorso Didattico</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #6a1b9a;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 1.1em;
        }
        
        .progress-container {
            background: #e0e0e0;
            border-radius: 10px;
            height: 12px;
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6a1b9a, #9c27b0);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .phase {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .phase.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .phase-title {
            background: linear-gradient(135deg, #6a1b9a, #9c27b0);
            color: white;
            padding: 15px 25px;
            border-radius: 12px 12px 0 0;
            font-size: 1.3em;
        }
        
        .phase-content {
            background: white;
            padding: 25px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .instruction {
            background: #f3e5f5;
            border-left: 4px solid #6a1b9a;
            padding: 12px 18px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            color: #4a148c;
        }
        
        .clickable-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .clickable-item {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .clickable-item:hover {
            border-color: #9c27b0;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.2);
        }
        
        .clickable-item.viewed {
            border-color: #9c27b0;
            background: #fce4ec;
        }
        
        .clickable-item.viewed::after {
            content: '✓';
            position: absolute;
            top: 10px;
            right: 12px;
            color: #9c27b0;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .clickable-item h3 {
            color: #6a1b9a;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .clickable-item .preview {
            color: #666;
            font-size: 0.95em;
        }
        
        .clickable-item .details {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
            color: #333;
        }
        
        .clickable-item.expanded .details {
            display: block;
        }
        
        .example-box {
            background: #fff8e1;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #ff9800;
        }
        
        .formula-box {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2em;
            margin: 12px 0;
        }
        
        .step-box {
            background: #e3f2fd;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #2196f3;
        }
        
        .warning-box {
            background: #ffebee;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #f44336;
        }
        
        .concept-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .concept-card.viewed {
            border-color: #9c27b0;
        }
        
        .concept-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            transition: background 0.3s ease;
        }
        
        .concept-header:hover {
            background: #f3e5f5;
        }
        
        .concept-card.viewed .concept-header {
            background: #fce4ec;
        }
        
        .concept-header h3 {
            color: #6a1b9a;
            font-size: 1.1em;
        }
        
        .concept-header .icon {
            font-size: 1.3em;
            transition: transform 0.3s ease;
        }
        
        .concept-card.expanded .concept-header .icon {
            transform: rotate(180deg);
        }
        
        .concept-body {
            display: none;
            padding: 0 20px 20px;
        }
        
        .concept-card.expanded .concept-body {
            display: block;
        }
        
        .quiz-section {
            margin-bottom: 25px;
        }
        
        .quiz-section h3 {
            color: #6a1b9a;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .question {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
        }
        
        .question.correct {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        .question.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }
        
        .question p {
            font-weight: 500;
            margin-bottom: 12px;
            color: #333;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 10px 14px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option:hover:not(.disabled) {
            border-color: #9c27b0;
            background: #fce4ec;
        }
        
        .option.selected {
            border-color: #9c27b0;
            background: #fce4ec;
        }
        
        .option.disabled {
            cursor: default;
        }
        
        .option.correct-answer {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        
        .option.wrong-answer {
            border-color: #f44336;
            background: #ffebee;
        }
        
        .option input {
            margin-right: 12px;
        }
        
        .feedback {
            display: none;
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.95em;
        }
        
        .feedback.correct {
            display: block;
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .feedback.incorrect {
            display: block;
            background: #ffebee;
            color: #c62828;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6a1b9a, #9c27b0);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(106, 27, 154, 0.4);
        }
        
        .btn-primary:disabled {
            background: #bdbdbd;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: 2px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .btn-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .review-area {
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .review-header {
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .review-header.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .review-header.review {
            background: #fff8e1;
            color: #f57c00;
        }
        
        .review-content {
            padding: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 10px 10px;
        }
        
        .score-display {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            border-radius: 12px;
            margin-bottom: 25px;
        }
        
        .score-display .score {
            font-size: 3em;
            font-weight: bold;
            color: #6a1b9a;
        }
        
        .score-display .label {
            color: #666;
            font-size: 1.1em;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .summary-table th, .summary-table td {
            padding: 12px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }
        
        .summary-table th {
            background: #f3e5f5;
            color: #6a1b9a;
        }
        
        .summary-table tr:nth-child(even) {
            background: #fafafa;
        }
        
        @media (max-width: 600px) {
            body { padding: 10px; }
            h1 { font-size: 1.5em; }
            .phase-content { padding: 15px; }
            .clickable-grid { grid-template-columns: 1fr; }
            .btn { padding: 10px 20px; font-size: 0.95em; }
            .btn-container { flex-direction: column; }
            .btn-container .btn { width: 100%; text-align: center; }
        }
        
        @media print {
            body { background: white; padding: 0; }
            .progress-container, .progress-text, .btn-container, .phase:not(#phase5) { display: none !important; }
            #phase5 { display: block !important; }
            .phase-title { background: #6a1b9a !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .review-header { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>I Prodotti Notevoli</h1>
        <p class="subtitle">Percorso didattico interattivo</p>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar" style="width: 20%"></div>
        </div>
        <p class="progress-text" id="progressText">Fase 1 di 5 — Somma per differenza</p>
        
        <!-- FASE 1: Somma per differenza -->
        <div class="phase active" id="phase1">
            <div class="phase-title">Fase 1 — Somma per differenza</div>
            <div class="phase-content">
                <div class="instruction">
                    Clicca su ogni elemento per scoprirne i dettagli. Devi visualizzarli tutti per proseguire.
                </div>
                
                <div class="clickable-grid">
                    <div class="clickable-item" data-phase="1" onclick="toggleItem(this)">
                        <h3>La formula</h3>
                        <p class="preview">La regola da ricordare</p>
                        <div class="details">
                            <div class="formula-box">
                                \((a + b)(a - b) = a^2 - b^2\)
                            </div>
                            <p>Il prodotto della <strong>somma</strong> di due termini per la loro <strong>differenza</strong> è uguale alla <strong>differenza dei quadrati</strong>.</p>
                            <p style="margin-top: 10px;">Nota: il risultato ha sempre e solo <strong>2 termini</strong>!</p>
                        </div>
                    </div>
                    
                    <div class="clickable-item" data-phase="1" onclick="toggleItem(this)">
                        <h3>Perché funziona</h3>
                        <p class="preview">La dimostrazione</p>
                        <div class="details">
                            <p>Verifichiamolo sviluppando il prodotto:</p>
                            <div class="step-box">
                                \((a + b)(a - b)\)<br>
                                \(= a \cdot a + a \cdot (-b) + b \cdot a + b \cdot (-b)\)<br>
                                \(= a^2 - ab + ab - b^2\)<br>
                                \(= a^2 - b^2\)
                            </div>
                            <p style="margin-top: 10px;">I termini \(-ab\) e \(+ab\) si annullano!</p>
                        </div>
                    </div>
                    
                    <div class="clickable-item" data-phase="1" onclick="toggleItem(this)">
                        <h3>Esempio semplice</h3>
                        <p class="preview">\((x + 5)(x - 5)\)</p>
                        <div class="details">
                            <p><strong>Calcola:</strong> \((x + 5)(x - 5)\)</p>
                            <div class="step-box">
                                Identifico: \(a = x\), \(b = 5\)
                            </div>
                            <div class="step-box">
                                Applico la formula: \(a^2 - b^2\)<br>
                                \(= x^2 - 5^2\)<br>
                                \(= x^2 - 25\)
                            </div>
                            <div class="formula-box">
                                <strong>Risultato:</strong> \(x^2 - 25\)
                            </div>
                        </div>
                    </div>
                    
                    <div class="clickable-item" data-phase="1" onclick="toggleItem(this)">
                        <h3>Esempio con coefficienti</h3>
                        <p class="preview">\((3a + 2b)(3a - 2b)\)</p>
                        <div class="details">
                            <p><strong>Calcola:</strong> \((3a + 2b)(3a - 2b)\)</p>
                            <div class="step-box">
                                Identifico: primo termine = \(3a\), secondo = \(2b\)
                            </div>
                            <div class="step-box">
                                Applico la formula:<br>
                                \(= (3a)^2 - (2b)^2\)<br>
                                \(= 9a^2 - 4b^2\)
                            </div>
                            <div class="warning-box">
                                <strong>Attenzione!</strong> \((3a)^2 = 9a^2\), non \(3a^2\)!<br>
                                Si eleva anche il coefficiente.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-container">
                    <span></span>
                    <button class="btn btn-primary" id="btn1" disabled onclick="nextPhase(2)">Continua →</button>
                </div>
            </div>
        </div>
        
        <!-- FASE 2: Quadrato di binomio -->
        <div class="phase" id="phase2">
            <div class="phase-title">Fase 2 — Quadrato di binomio</div>
            <div class="phase-content">
                <div class="instruction">
                    Clicca su ogni elemento per scoprirne i dettagli. Devi visualizzarli tutti per proseguire.
                </div>
                
                <div class="clickable-grid">
                    <div class="clickable-item" data-phase="2" onclick="toggleItem(this)">
                        <h3>Le formule</h3>
                        <p class="preview">Somma e differenza al quadrato</p>
                        <div class="details">
                            <div class="formula-box">
                                \((a + b)^2 = a^2 + 2ab + b^2\)
                            </div>
                            <div class="formula-box">
                                \((a - b)^2 = a^2 - 2ab + b^2\)
                            </div>
                            <p>Il risultato ha sempre <strong>3 termini</strong>:</p>
                            <ul style="margin: 10px 0 0 20px;">
                                <li>Quadrato del primo</li>
                                <li><strong>Doppio prodotto</strong> (con il segno!)</li>
                                <li>Quadrato del secondo (sempre positivo!)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="clickable-item" data-phase="2" onclick="toggleItem(this)">
                        <h3>L'errore più comune</h3>
                        <p class="preview">Cosa NON fare</p>
                        <div class="details">
                            <div class="warning-box">
                                <strong>ERRORE GRAVE:</strong><br><br>
                                \((a + b)^2 \neq a^2 + b^2\) ✗<br><br>
                                Manca il <strong>doppio prodotto</strong> \(2ab\)!
                            </div>
                            <div class="example-box">
                                <strong>Verifica con i numeri:</strong><br>
                                \((3 + 2)^2 = 5^2 = 25\)<br>
                                \(3^2 + 2^2 = 9 + 4 = 13\) ✗<br>
                                \(3^2 + 2 \cdot 3 \cdot 2 + 2^2 = 9 + 12 + 4 = 25\) ✓
                            </div>
                        </div>
                    </div>
                    
                    <div class="clickable-item" data-phase="2" onclick="toggleItem(this)">
                        <h3>Esempio: somma al quadrato</h3>
                        <p class="preview">\((x + 4)^2\)</p>
                        <div class="details">
                            <p><strong>Calcola:</strong> \((x + 4)^2\)</p>
                            <div class="step-box">
                                Identifico: \(a = x\), \(b = 4\)
                            </div>
                            <div class="step-box">
                                Applico: \(a^2 + 2ab + b^2\)<br>
                                \(= x^2 + 2 \cdot x \cdot 4 + 4^2\)<br>
                                \(= x^2 + 8x + 16\)
                            </div>
                            <div class="formula-box">
                                <strong>Risultato:</strong> \(x^2 + 8x + 16\)
                            </div>
                        </div>
                    </div>
                    
                    <div class="clickable-item" data-phase="2" onclick="toggleItem(this)">
                        <h3>Esempio: differenza al quadrato</h3>
                        <p class="preview">\((3a - 2b)^2\)</p>
                        <div class="details">
                            <p><strong>Calcola:</strong> \((3a - 2b)^2\)</p>
                            <div class="step-box">
                                Identifico: primo = \(3a\), secondo = \(2b\)
                            </div>
                            <div class="step-box">
                                Applico: \(a^2 - 2ab + b^2\)<br>
                                \(= (3a)^2 - 2 \cdot (3a) \cdot (2b) + (2b)^2\)<br>
                                \(= 9a^2 - 12ab + 4b^2\)
                            </div>
                            <div class="warning-box">
                                L'ultimo termine è \(+4b^2\), <strong>mai</strong> \(-4b^2\)!<br>
                                Il quadrato è sempre positivo.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevPhase(1)">← Indietro</button>
                    <button class="btn btn-primary" id="btn2" disabled onclick="nextPhase(3)">Continua →</button>
                </div>
            </div>
        </div>
        
        <!-- FASE 3: Cubo di binomio e riepilogo -->
        <div class="phase" id="phase3">
            <div class="phase-title">Fase 3 — Cubo di binomio e riepilogo</div>
            <div class="phase-content">
                <div class="instruction">
                    Espandi ogni card per completare lo studio. Devi visualizzarle tutte per proseguire.
                </div>
                
                <div class="concept-card" data-phase="3" onclick="toggleCard(this)">
                    <div class="concept-header">
                        <h3>Cubo di binomio: la formula</h3>
                        <span class="icon">▼</span>
                    </div>
                    <div class="concept-body">
                        <div class="formula-box">
                            \((a + b)^3 = a^3 + 3a^2b + 3ab^2 + b^3\)
                        </div>
                        <div class="formula-box">
                            \((a - b)^3 = a^3 - 3a^2b + 3ab^2 - b^3\)
                        </div>
                        <p>Il risultato ha <strong>4 termini</strong>. Nel caso della differenza, i segni si alternano: \(+ - + -\)</p>
                    </div>
                </div>
                
                <div class="concept-card" data-phase="3" onclick="toggleCard(this)">
                    <div class="concept-header">
                        <h3>Esempio: cubo di somma</h3>
                        <span class="icon">▼</span>
                    </div>
                    <div class="concept-body">
                        <p><strong>Calcola:</strong> \((x + 2)^3\)</p>
                        <div class="step-box">
                            Identifico: \(a = x\), \(b = 2\)
                        </div>
                        <div class="step-box">
                            Applico la formula:<br>
                            \(= x^3 + 3 \cdot x^2 \cdot 2 + 3 \cdot x \cdot 2^2 + 2^3\)<br>
                            \(= x^3 + 6x^2 + 12x + 8\)
                        </div>
                        <div class="formula-box">
                            <strong>Risultato:</strong> \(x^3 + 6x^2 + 12x + 8\)
                        </div>
                    </div>
                </div>
                
                <div class="concept-card" data-phase="3" onclick="toggleCard(this)">
                    <div class="concept-header">
                        <h3>Esempio: cubo di differenza</h3>
                        <span class="icon">▼</span>
                    </div>
                    <div class="concept-body">
                        <p><strong>Calcola:</strong> \((a - 1)^3\)</p>
                        <div class="step-box">
                            Identifico: primo = \(a\), secondo = \(1\)
                        </div>
                        <div class="step-box">
                            Applico con segni alternati \((+ - + -)\):<br>
                            \(= a^3 - 3 \cdot a^2 \cdot 1 + 3 \cdot a \cdot 1^2 - 1^3\)<br>
                            \(= a^3 - 3a^2 + 3a - 1\)
                        </div>
                        <div class="formula-box">
                            <strong>Risultato:</strong> \(a^3 - 3a^2 + 3a - 1\)
                        </div>
                    </div>
                </div>
                
                <div class="concept-card" data-phase="3" onclick="toggleCard(this)">
                    <div class="concept-header">
                        <h3>Riepilogo delle formule</h3>
                        <span class="icon">▼</span>
                    </div>
                    <div class="concept-body">
                        <table class="summary-table">
                            <tr>
                                <th>Prodotto notevole</th>
                                <th>Formula</th>
                            </tr>
                            <tr>
                                <td>Somma per differenza</td>
                                <td>\((a+b)(a-b) = a^2 - b^2\)</td>
                            </tr>
                            <tr>
                                <td>Quadrato di somma</td>
                                <td>\((a+b)^2 = a^2 + 2ab + b^2\)</td>
                            </tr>
                            <tr>
                                <td>Quadrato di differenza</td>
                                <td>\((a-b)^2 = a^2 - 2ab + b^2\)</td>
                            </tr>
                            <tr>
                                <td>Cubo di somma</td>
                                <td>\((a+b)^3 = a^3 + 3a^2b + 3ab^2 + b^3\)</td>
                            </tr>
                            <tr>
                                <td>Cubo di differenza</td>
                                <td>\((a-b)^3 = a^3 - 3a^2b + 3ab^2 - b^3\)</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevPhase(2)">← Indietro</button>
                    <button class="btn btn-primary" id="btn3" disabled onclick="nextPhase(4)">Vai alla verifica →</button>
                </div>
            </div>
        </div>
        
        <!-- FASE 4: Verifica -->
        <div class="phase" id="phase4">
            <div class="phase-title">Fase 4 — Verifica</div>
            <div class="phase-content">
                <div class="instruction">
                    Rispondi a tutte le domande, poi clicca su "Verifica risposte".
                </div>
                
                <div class="quiz-section" data-area="sommadiff">
                    <h3>Somma per differenza</h3>
                    
                    <div class="question" data-correct="c">
                        <p>1. Calcola: \((x + 3)(x - 3)\)</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q1" value="a"> \(x^2 + 9\)</label>
                            <label class="option"><input type="radio" name="q1" value="b"> \(x^2 - 6x + 9\)</label>
                            <label class="option"><input type="radio" name="q1" value="c"> \(x^2 - 9\)</label>
                            <label class="option"><input type="radio" name="q1" value="d"> \(x^2 + 6x - 9\)</label>
                        </div>
                        <div class="feedback" data-explanation="Somma per differenza: (a+b)(a-b) = a² - b² = x² - 9."></div>
                    </div>
                    
                    <div class="question" data-correct="b">
                        <p>2. Calcola: \((2x + 5)(2x - 5)\)</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q2" value="a"> \(2x^2 - 25\)</label>
                            <label class="option"><input type="radio" name="q2" value="b"> \(4x^2 - 25\)</label>
                            <label class="option"><input type="radio" name="q2" value="c"> \(4x^2 + 25\)</label>
                            <label class="option"><input type="radio" name="q2" value="d"> \(4x^2 - 10x - 25\)</label>
                        </div>
                        <div class="feedback" data-explanation="(2x)² - 5² = 4x² - 25. Ricorda: (2x)² = 4x², non 2x²!"></div>
                    </div>
                    
                    <div class="question" data-correct="a">
                        <p>3. Calcola: \((4a + 3b)(4a - 3b)\)</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q3" value="a"> \(16a^2 - 9b^2\)</label>
                            <label class="option"><input type="radio" name="q3" value="b"> \(4a^2 - 3b^2\)</label>
                            <label class="option"><input type="radio" name="q3" value="c"> \(16a^2 + 9b^2\)</label>
                            <label class="option"><input type="radio" name="q3" value="d"> \(16a^2 - 12ab - 9b^2\)</label>
                        </div>
                        <div class="feedback" data-explanation="(4a)² - (3b)² = 16a² - 9b²."></div>
                    </div>
                </div>
                
                <div class="quiz-section" data-area="quadrato">
                    <h3>Quadrato di binomio</h3>
                    
                    <div class="question" data-correct="d">
                        <p>4. Calcola: \((x + 5)^2\)</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q4" value="a"> \(x^2 + 25\)</label>
                            <label class="option"><input type="radio" name="q4" value="b"> \(x^2 + 5x + 25\)</label>
                            <label class="option"><input type="radio" name="q4" value="c"> \(x^2 - 10x + 25\)</label>
                            <label class="option"><input type="radio" name="q4" value="d"> \(x^2 + 10x + 25\)</label>
                        </div>
                        <div class="feedback" data-explanation="x² + 2·x·5 + 5² = x² + 10x + 25. Il doppio prodotto è 2·x·5 = 10x."></div>
                    </div>
                    
                    <div class="question" data-correct="b">
                        <p>5. Calcola: \((a - 3)^2\)</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q5" value="a"> \(a^2 - 9\)</label>
                            <label class="option"><input type="radio" name="q5" value="b"> \(a^2 - 6a + 9\)</label>
                            <label class="option"><input type="radio" name="q5" value="c"> \(a^2 + 6a + 9\)</label>
                            <label class="option"><input type="radio" name="q5" value="d"> \(a^2 - 6a - 9\)</label>
                        </div>
                        <div class="feedback" data-explanation="a² - 2·a·3 + 3² = a² - 6a + 9. L'ultimo termine è sempre +9, non -9!"></div>
                    </div>
                    
                    <div class="question" data-correct="c">
                        <p>6. Calcola: \((2x + 3)^2\)</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q6" value="a"> \(2x^2 + 6x + 9\)</label>
                            <label class="option"><input type="radio" name="q6" value="b"> \(4x^2 + 6x + 9\)</label>
                            <label class="option"><input type="radio" name="q6" value="c"> \(4x^2 + 12x + 9\)</label>
                            <label class="option"><input type="radio" name="q6" value="d"> \(4x^2 + 9\)</label>
                        </div>
                        <div class="feedback" data-explanation="(2x)² + 2·(2x)·3 + 3² = 4x² + 12x + 9."></div>
                    </div>
                    
                    <div class="question" data-correct="a">
                        <p>7. Quale di queste uguaglianze è FALSA?</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q7" value="a"> \((a + b)^2 = a^2 + b^2\)</label>
                            <label class="option"><input type="radio" name="q7" value="b"> \((a + b)^2 = a^2 + 2ab + b^2\)</label>
                            <label class="option"><input type="radio" name="q7" value="c"> \((a - b)^2 = a^2 - 2ab + b^2\)</label>
                            <label class="option"><input type="radio" name="q7" value="d"> \((a + b)(a - b) = a^2 - b^2\)</label>
                        </div>
                        <div class="feedback" data-explanation="(a + b)² ≠ a² + b². Manca il doppio prodotto 2ab! Questo è l'errore più comune."></div>
                    </div>
                </div>
                
                <div class="quiz-section" data-area="cubo">
                    <h3>Cubo di binomio</h3>
                    
                    <div class="question" data-correct="c">
                        <p>8. Calcola: \((x + 1)^3\)</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q8" value="a"> \(x^3 + 1\)</label>
                            <label class="option"><input type="radio" name="q8" value="b"> \(x^3 + 3x + 1\)</label>
                            <label class="option"><input type="radio" name="q8" value="c"> \(x^3 + 3x^2 + 3x + 1\)</label>
                            <label class="option"><input type="radio" name="q8" value="d"> \(x^3 + 2x^2 + 2x + 1\)</label>
                        </div>
                        <div class="feedback" data-explanation="x³ + 3·x²·1 + 3·x·1² + 1³ = x³ + 3x² + 3x + 1."></div>
                    </div>
                    
                    <div class="question" data-correct="b">
                        <p>9. Calcola: \((a - 2)^3\)</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q9" value="a"> \(a^3 - 6a^2 + 12a + 8\)</label>
                            <label class="option"><input type="radio" name="q9" value="b"> \(a^3 - 6a^2 + 12a - 8\)</label>
                            <label class="option"><input type="radio" name="q9" value="c"> \(a^3 + 6a^2 - 12a - 8\)</label>
                            <label class="option"><input type="radio" name="q9" value="d"> \(a^3 - 8\)</label>
                        </div>
                        <div class="feedback" data-explanation="a³ - 3·a²·2 + 3·a·4 - 8 = a³ - 6a² + 12a - 8. I segni si alternano: + - + -."></div>
                    </div>
                    
                    <div class="question" data-correct="d">
                        <p>10. Quanti termini ha il risultato di \((a + b)^3\)?</p>
                        <div class="options">
                            <label class="option"><input type="radio" name="q10" value="a"> 2</label>
                            <label class="option"><input type="radio" name="q10" value="b"> 3</label>
                            <label class="option"><input type="radio" name="q10" value="c"> 5</label>
                            <label class="option"><input type="radio" name="q10" value="d"> 4</label>
                        </div>
                        <div class="feedback" data-explanation="Il cubo di binomio ha sempre 4 termini: a³ + 3a²b + 3ab² + b³."></div>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevPhase(3)">← Indietro</button>
                    <button class="btn btn-primary" id="btnVerify" onclick="verifyAnswers()">Verifica risposte</button>
                    <button class="btn btn-primary" id="btnToReview" style="display: none;" onclick="nextPhase(5)">Vai al ripasso →</button>
                </div>
            </div>
        </div>
        
        <!-- FASE 5: Ripasso -->
        <div class="phase" id="phase5">
            <div class="phase-title">Fase 5 — Ripasso personalizzato</div>
            <div class="phase-content">
                <div class="score-display">
                    <div class="score" id="finalScore">0/10</div>
                    <div class="label">Risposte corrette</div>
                </div>
                
                <div id="reviewContent"></div>
                
                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevPhase(4)">← Rivedi errori</button>
                    <div>
                        <button class="btn btn-secondary" onclick="window.print()" style="margin-right: 10px;">Stampa ripasso</button>
                        <button class="btn btn-primary" onclick="restart()">Ricomincia</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let viewedItems = { 1: new Set(), 2: new Set(), 3: new Set() };
        let totalItems = { 1: 4, 2: 4, 3: 4 };
        let quizResults = {};
        let verified = false;
        
        document.addEventListener('DOMContentLoaded', function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ]
            });
        });
        
        function toggleItem(element) {
            element.classList.toggle('expanded');
            if (!element.classList.contains('viewed')) {
                element.classList.add('viewed');
                const phase = element.dataset.phase;
                viewedItems[phase].add(element);
                checkPhaseCompletion(phase);
            }
            renderMathInElement(element, {
                delimiters: [{left: '\\(', right: '\\)', display: false}, {left: '\\[', right: '\\]', display: true}]
            });
        }
        
        function toggleCard(element) {
            element.classList.toggle('expanded');
            if (!element.classList.contains('viewed')) {
                element.classList.add('viewed');
                const phase = element.dataset.phase;
                viewedItems[phase].add(element);
                checkPhaseCompletion(phase);
            }
            renderMathInElement(element, {
                delimiters: [{left: '\\(', right: '\\)', display: false}, {left: '\\[', right: '\\]', display: true}]
            });
        }
        
        function checkPhaseCompletion(phase) {
            const btn = document.getElementById('btn' + phase);
            if (viewedItems[phase].size >= totalItems[phase]) {
                btn.disabled = false;
            }
        }
        
        function nextPhase(n) {
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById('phase' + n).classList.add('active');
            updateProgress(n);
            window.scrollTo(0, 0);
            if (n === 5) generateReview();
        }
        
        function prevPhase(n) {
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById('phase' + n).classList.add('active');
            updateProgress(n);
            window.scrollTo(0, 0);
        }
        
        function updateProgress(phase) {
            const percentage = phase * 20;
            document.getElementById('progressBar').style.width = percentage + '%';
            const titles = {
                1: 'Somma per differenza',
                2: 'Quadrato di binomio',
                3: 'Cubo di binomio e riepilogo',
                4: 'Verifica',
                5: 'Ripasso personalizzato'
            };
            document.getElementById('progressText').textContent = `Fase ${phase} di 5 — ${titles[phase]}`;
        }
        
        function verifyAnswers() {
            const questions = document.querySelectorAll('.question');
            let allAnswered = true;
            let firstUnanswered = null;
            
            questions.forEach((q, index) => {
                const name = 'q' + (index + 1);
                const selected = document.querySelector(`input[name="${name}"]:checked`);
                if (!selected) {
                    allAnswered = false;
                    if (!firstUnanswered) firstUnanswered = q;
                }
            });
            
            if (!allAnswered) {
                alert('Rispondi a tutte le domande prima di verificare.');
                firstUnanswered.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            let correct = 0;
            quizResults = { sommadiff: [], quadrato: [], cubo: [] };
            
            questions.forEach((q, index) => {
                const name = 'q' + (index + 1);
                const selected = document.querySelector(`input[name="${name}"]:checked`);
                const correctAnswer = q.dataset.correct;
                const area = q.closest('.quiz-section').dataset.area;
                const feedback = q.querySelector('.feedback');
                const explanation = feedback.dataset.explanation;
                
                q.querySelectorAll('.option').forEach(opt => {
                    opt.classList.add('disabled');
                    opt.querySelector('input').disabled = true;
                });
                
                if (selected.value === correctAnswer) {
                    correct++;
                    q.classList.add('correct');
                    feedback.classList.add('correct');
                    feedback.innerHTML = '✓ Corretto! ' + explanation;
                    quizResults[area].push({ correct: true, question: index + 1 });
                } else {
                    q.classList.add('incorrect');
                    feedback.classList.add('incorrect');
                    feedback.innerHTML = '✗ Sbagliato. ' + explanation;
                    quizResults[area].push({ correct: false, question: index + 1 });
                    q.querySelectorAll('.option').forEach(opt => {
                        if (opt.querySelector('input').value === correctAnswer) {
                            opt.classList.add('correct-answer');
                        }
                    });
                    selected.parentElement.classList.add('wrong-answer');
                }
            });
            
            document.getElementById('finalScore').textContent = correct + '/10';
            document.getElementById('btnVerify').style.display = 'none';
            document.getElementById('btnToReview').style.display = 'inline-block';
            verified = true;
        }
        
        function generateReview() {
            const content = document.getElementById('reviewContent');
            content.innerHTML = '';
            
            const areas = [
                {
                    id: 'sommadiff',
                    title: 'Somma per differenza',
                    content: `
                        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 15px;">
                            <strong style="font-size: 1.1em;">\\((a + b)(a - b) = a^2 - b^2\\)</strong>
                        </div>
                        <p>Il prodotto della somma per la differenza dà la <strong>differenza dei quadrati</strong>.</p>
                        <p style="margin-top: 10px;"><strong>Esempio:</strong> \\((3x + 2)(3x - 2) = 9x^2 - 4\\)</p>
                        <p style="margin-top: 10px;">Ricorda: \\((3x)^2 = 9x^2\\), non \\(3x^2\\)!</p>
                    `
                },
                {
                    id: 'quadrato',
                    title: 'Quadrato di binomio',
                    content: `
                        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 15px;">
                            <strong>\\((a + b)^2 = a^2 + 2ab + b^2\\)</strong><br>
                            <strong>\\((a - b)^2 = a^2 - 2ab + b^2\\)</strong>
                        </div>
                        <p>Il risultato ha sempre <strong>3 termini</strong>. Non dimenticare mai il <strong>doppio prodotto</strong>!</p>
                        <div style="background: #ffebee; padding: 10px; border-radius: 6px; margin: 10px 0;">
                            <strong>ERRORE COMUNE:</strong> \\((a + b)^2 \\neq a^2 + b^2\\)
                        </div>
                        <p>L'ultimo termine (\\(b^2\\)) è <strong>sempre positivo</strong>, anche nel quadrato di differenza.</p>
                    `
                },
                {
                    id: 'cubo',
                    title: 'Cubo di binomio',
                    content: `
                        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 15px;">
                            <strong>\\((a + b)^3 = a^3 + 3a^2b + 3ab^2 + b^3\\)</strong><br>
                            <strong>\\((a - b)^3 = a^3 - 3a^2b + 3ab^2 - b^3\\)</strong>
                        </div>
                        <p>Il risultato ha sempre <strong>4 termini</strong>.</p>
                        <p style="margin-top: 10px;">Nel cubo di differenza i segni si alternano: \\(+ - + -\\)</p>
                        <p style="margin-top: 10px;"><strong>Esempio:</strong> \\((x + 2)^3 = x^3 + 6x^2 + 12x + 8\\)</p>
                    `
                }
            ];
            
            areas.forEach(area => {
                const results = quizResults[area.id];
                const correctCount = results.filter(r => r.correct).length;
                const totalCount = results.length;
                const needsReview = correctCount < totalCount;
                
                const div = document.createElement('div');
                div.className = 'review-area';
                div.innerHTML = `
                    <div class="review-header ${needsReview ? 'review' : 'success'}">
                        ${needsReview ? '⚠' : '✓'} ${area.title} — ${correctCount}/${totalCount} corrette
                        ${needsReview ? '(Da rivedere)' : '(Hai capito bene)'}
                    </div>
                    <div class="review-content">
                        ${needsReview ? area.content : '<p>Ottimo lavoro! Hai dimostrato di aver compreso questa sezione.</p>'}
                    </div>
                `;
                content.appendChild(div);
            });
            
            renderMathInElement(content, {
                delimiters: [{left: '\\(', right: '\\)', display: false}, {left: '\\[', right: '\\]', display: true}]
            });
        }
        
        function restart() {
            viewedItems = { 1: new Set(), 2: new Set(), 3: new Set() };
            quizResults = {};
            verified = false;
            
            document.querySelectorAll('.clickable-item, .concept-card').forEach(el => {
                el.classList.remove('viewed', 'expanded');
            });
            
            document.querySelectorAll('.question').forEach(q => {
                q.classList.remove('correct', 'incorrect');
                q.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('disabled', 'selected', 'correct-answer', 'wrong-answer');
                    opt.querySelector('input').disabled = false;
                    opt.querySelector('input').checked = false;
                });
                q.querySelector('.feedback').classList.remove('correct', 'incorrect');
            });
            
            document.getElementById('btn1').disabled = true;
            document.getElementById('btn2').disabled = true;
            document.getElementById('btn3').disabled = true;
            document.getElementById('btnVerify').style.display = 'inline-block';
            document.getElementById('btnToReview').style.display = 'none';
            
            nextPhase(1);
        }
    </script>
</body>
</html>
