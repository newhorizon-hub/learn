<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Numeri Relativi - Percorso Introduttivo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 1.8em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .progress-bar { display: flex; justify-content: center; gap: 10px; padding: 20px; background: #f8f9fa; flex-wrap: wrap; }
        .progress-step { width: 40px; height: 40px; border-radius: 50%; background: #e0e0e0; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #666; transition: all 0.3s; }
        .progress-step.active { background: #667eea; color: white; transform: scale(1.1); }
        .progress-step.completed { background: #27ae60; color: white; }
        .phase { display: none; padding: 30px; }
        .phase.active { display: block; }
        .phase-title { font-size: 1.4em; color: #333; margin-bottom: 10px; }
        .phase-subtitle { color: #666; margin-bottom: 20px; }
        .card-counter { background: #e8f4fd; padding: 10px 15px; border-radius: 10px; margin-bottom: 20px; color: #1976d2; font-weight: 500; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .card { background: linear-gradient(145deg, #f5f7fa 0%, #e8ecf1 100%); border-radius: 15px; padding: 20px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .card.viewed { border-color: #27ae60; background: linear-gradient(145deg, #e8f5e9 0%, #c8e6c9 100%); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card-title { font-weight: bold; color: #333; font-size: 1.05em; }
        .card-check { color: #27ae60; font-size: 1.3em; opacity: 0; transition: opacity 0.3s; }
        .card.viewed .card-check { opacity: 1; }
        .card-hint { color: #888; font-size: 0.85em; }
        .card-content { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd; color: #444; line-height: 1.7; }
        .card.expanded .card-content { display: block; }
        .card.expanded .card-hint { display: none; }
        .formula-box { background: #fff3e0; border-left: 4px solid #ff9800; padding: 12px 15px; margin: 10px 0; border-radius: 0 8px 8px 0; font-family: 'Courier New', monospace; }
        .example-box { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 12px 15px; margin: 10px 0; border-radius: 0 8px 8px 0; }
        .positive { color: #27ae60; font-weight: bold; }
        .negative { color: #e74c3c; font-weight: bold; }
        .zero { color: #3498db; font-weight: bold; }
        .accordion { margin-bottom: 10px; border-radius: 10px; overflow: hidden; border: 1px solid #e0e0e0; }
        .accordion-header { background: #f5f7fa; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .accordion-header:hover { background: #e8ecf1; }
        .accordion.viewed .accordion-header { background: #e8f5e9; }
        .accordion-title { font-weight: 600; color: #333; }
        .accordion-icon { transition: transform 0.3s; }
        .accordion.expanded .accordion-icon { transform: rotate(180deg); }
        .accordion-content { display: none; padding: 20px; background: white; line-height: 1.7; }
        .accordion.expanded .accordion-content { display: block; }
        .number-line { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 15px; background: #f5f5f5; border-radius: 10px; margin: 10px 0; flex-wrap: wrap; }
        .number-line span { padding: 8px 12px; border-radius: 8px; font-weight: bold; font-size: 1.1em; }
        .number-line .negative { background: #ffebee; color: #c62828; border: 2px solid #e57373; }
        .number-line .positive { background: #e8f5e9; color: #2e7d32; border: 2px solid #81c784; }
        .number-line .zero { background: #e3f2fd; color: #1565c0; border: 2px solid #64b5f6; }
        .quiz-question { background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .quiz-question h3 { color: #333; margin-bottom: 15px; font-size: 1.05em; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; }
        .quiz-option { padding: 12px 15px; background: white; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .quiz-option:hover:not(.disabled) { border-color: #667eea; background: #f0f4ff; }
        .quiz-option.selected { border-color: #667eea; background: #e8f0ff; }
        .quiz-option.correct { border-color: #27ae60; background: #e8f5e9; }
        .quiz-option.wrong { border-color: #e74c3c; background: #ffebee; }
        .quiz-option.disabled { pointer-events: none; }
        .feedback { padding: 10px 15px; border-radius: 8px; margin-top: 10px; display: none; }
        .feedback.show { display: block; }
        .feedback.correct { background: #e8f5e9; color: #2e7d32; }
        .feedback.wrong { background: #ffebee; color: #c62828; }
        .category-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 15px; border-radius: 10px; margin: 20px 0 15px 0; font-weight: 600; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 25px; flex-wrap: wrap; gap: 10px; }
        .btn { padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102,126,234,0.4); }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-success { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; }
        .score-display { text-align: center; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; color: white; margin-bottom: 25px; }
        .score { font-size: 3em; font-weight: bold; }
        .score-label { font-size: 1.1em; opacity: 0.9; }
        .review-section { background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 15px; }
        .review-section h3 { color: #333; margin-bottom: 10px; }
        .review-section.mastered { border-left: 4px solid #27ae60; }
        .review-section.needs-review { border-left: 4px solid #ff9800; }
        .wrong-item { margin-top: 10px; padding: 12px; background: white; border-radius: 8px; border-left: 3px solid #e74c3c; }
        @media print { body { background: white; } .container { box-shadow: none; } .header, .progress-bar, .nav-buttons { display: none; } .phase { display: none !important; } #phase5 { display: block !important; } }
        @media (max-width: 600px) { .header h1 { font-size: 1.4em; } .phase { padding: 20px; } .cards-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå°Ô∏è I Numeri Relativi</h1>
            <p>Definizioni e Linea dei Numeri</p>
        </div>
        <div class="progress-bar">
            <div class="progress-step active">1</div>
            <div class="progress-step">2</div>
            <div class="progress-step">3</div>
            <div class="progress-step">4</div>
            <div class="progress-step">5</div>
        </div>

        <!-- FASE 1: Definizione e Insieme ‚Ñ§ -->
        <div id="phase1" class="phase active">
            <div class="phase-title">üìò Fase 1: Definizione e Insieme ‚Ñ§</div>
            <div class="phase-subtitle">Clicca su ogni card per scoprire i concetti fondamentali</div>
            <div class="card-counter">Card visualizzate: <span id="counter1">0</span>/2</div>
            <div class="cards-grid">
                <div class="card" data-card="1">
                    <div class="card-header"><span class="card-title">Cosa sono i Numeri Relativi?</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        I <strong>numeri relativi</strong> sono numeri dotati di <strong>segno</strong>: positivo (+) o negativo (‚àí).<br><br>
                        A differenza dei numeri naturali (0, 1, 2, 3...), i numeri relativi possono rappresentare anche quantit√† "sotto zero".
                    </div>
                </div>
                <div class="card" data-card="2">
                    <div class="card-header"><span class="card-title">L'Insieme ‚Ñ§</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        L'insieme dei numeri relativi interi si indica con <strong>‚Ñ§</strong>:
                        <div class="formula-box">‚Ñ§ = {..., ‚àí3, ‚àí2, ‚àí1, 0, +1, +2, +3, ...}</div>
                        L'insieme si estende all'infinito sia verso i negativi che verso i positivi.
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <div></div>
                <button class="btn btn-primary" id="next1" disabled>Prosegui ‚Üí</button>
            </div>
        </div>

        <!-- FASE 2: Valore Assoluto e Numeri Opposti -->
        <div id="phase2" class="phase">
            <div class="phase-title">üìó Fase 2: Valore Assoluto e Numeri Opposti</div>
            <div class="phase-subtitle">Clicca su ogni card per approfondire</div>
            <div class="card-counter">Card visualizzate: <span id="counter2">0</span>/2</div>
            <div class="cards-grid">
                <div class="card" data-card="3">
                    <div class="card-header"><span class="card-title">üìê Valore Assoluto</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        Il <strong>valore assoluto</strong> |a| di un numero √® la sua <strong>distanza dallo zero</strong>.
                        <div class="example-box">
                            |+5| = 5<br>
                            |‚àí5| = 5<br>
                            |0| = 0
                        </div>
                        <strong>Nota:</strong> Il v.a. √® <strong>sempre ‚â• 0</strong>
                    </div>
                </div>
                <div class="card" data-card="4">
                    <div class="card-header"><span class="card-title">üîÑ Numeri Opposti</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        Due numeri sono <strong>opposti</strong> se hanno lo stesso v.a. ma <strong>segno contrario</strong>.
                        <div class="example-box">
                            Opposto di <span class="positive">+5</span> √® <span class="negative">‚àí5</span><br>
                            Opposto di <span class="negative">‚àí3</span> √® <span class="positive">+3</span><br>
                            Opposto di <span class="zero">0</span> √® <span class="zero">0</span>
                        </div>
                        <div class="formula-box">Propriet√†: a + (‚àía) = 0</div>
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(1)">‚Üê Indietro</button>
                <button class="btn btn-primary" id="next2" disabled>Prosegui ‚Üí</button>
            </div>
        </div>

        <!-- FASE 3: La Linea dei Numeri e il Confronto -->
        <div id="phase3" class="phase">
            <div class="phase-title">üìô Fase 3: Linea dei Numeri e Confronto</div>
            <div class="phase-subtitle">Espandi ogni sezione per approfondire</div>
            <div class="card-counter">Sezioni visualizzate: <span id="counter3">0</span>/4</div>

            <div class="accordion" data-acc="1">
                <div class="accordion-header"><span class="accordion-title">üìè La Linea dei Numeri</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    <div class="number-line">
                        <span class="negative">‚àí5</span><span class="negative">‚àí4</span><span class="negative">‚àí3</span><span class="negative">‚àí2</span><span class="negative">‚àí1</span>
                        <span class="zero">0</span>
                        <span class="positive">+1</span><span class="positive">+2</span><span class="positive">+3</span><span class="positive">+4</span><span class="positive">+5</span>
                    </div>
                    <div class="formula-box">‚Üê Sinistra: i numeri <strong>diminuiscono</strong><br>‚Üí Destra: i numeri <strong>aumentano</strong></div>
                </div>
            </div>
            <div class="accordion" data-acc="2">
                <div class="accordion-header"><span class="accordion-title">‚öñÔ∏è Confronto tra Numeri Relativi</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    ‚Ä¢ Ogni <span class="positive">positivo</span> √® <strong>maggiore</strong> di 0 e di ogni negativo<br>
                    ‚Ä¢ Ogni <span class="negative">negativo</span> √® <strong>minore</strong> di 0<br>
                    ‚Ä¢ Tra due negativi, √® maggiore quello con v.a. <strong>minore</strong>
                    <div class="example-box">‚àí2 > ‚àí5 perch√© |‚àí2| < |‚àí5|</div>
                </div>
            </div>
            <div class="accordion" data-acc="3">
                <div class="accordion-header"><span class="accordion-title">üìä Esempio di Ordinamento</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    <strong>Ordina dal pi√π piccolo al pi√π grande:</strong><br>‚àí7, +3, ‚àí2, 0, +1, ‚àí5
                    <div class="number-line">
                        <span class="negative">‚àí7</span><span class="negative">‚àí5</span><span class="negative">‚àí2</span>
                        <span class="zero">0</span>
                        <span class="positive">+1</span><span class="positive">+3</span>
                    </div>
                    <div class="formula-box">‚àí7 < ‚àí5 < ‚àí2 < 0 < +1 < +3</div>
                </div>
            </div>
            <div class="accordion" data-acc="4">
                <div class="accordion-header"><span class="accordion-title">üåç Esempi nella Vita Reale</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    üå°Ô∏è <strong>Temperature:</strong> ‚àí5¬∞C (sotto zero), +20¬∞C (sopra zero)<br><br>
                    üèîÔ∏è <strong>Altitudini:</strong> +8848 m (Everest), ‚àí400 m (Mar Morto)<br><br>
                    üí∞ <strong>Conti bancari:</strong> +500 (credito), ‚àí100 (debito)<br><br>
                    üìÖ <strong>Anni:</strong> 50 a.C. (‚àí50), 2024 d.C. (+2024)
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(2)">‚Üê Indietro</button>
                <button class="btn btn-primary" id="next3" disabled>Vai alla Verifica ‚Üí</button>
            </div>
        </div>

        <!-- FASE 4: Verifica -->
        <div id="phase4" class="phase">
            <div class="phase-title">üìù Fase 4: Verifica delle Conoscenze</div>
            <div class="phase-subtitle">Rispondi a tutte le domande, poi clicca "Verifica Risposte"</div>
            <div id="quiz-container"></div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(3)">‚Üê Indietro</button>
                <button class="btn btn-success" id="verifyBtn" onclick="verifyQuiz()">‚úì Verifica Risposte</button>
            </div>
        </div>

        <!-- FASE 5: Ripasso -->
        <div id="phase5" class="phase">
            <div class="phase-title">üìä Fase 5: Ripasso Personalizzato</div>
            <div class="phase-subtitle">Riepilogo basato sui tuoi risultati</div>
            <div class="score-display">
                <div class="score"><span id="finalScore">0</span>/10</div>
                <div class="score-label">Risposte corrette</div>
            </div>
            <div id="review-container"></div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(4)">‚Üê Rivedi Errori</button>
                <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Stampa Ripasso</button>
            </div>
        </div>
    </div>

    <script>
        const quizData = [
            { category: "Definizioni", question: "Qual √® il simbolo dell'insieme dei numeri relativi interi?", options: ["‚Ñï", "‚Ñ§", "‚Ñö", "‚Ñù"], correct: 1, explanation: "‚Ñ§ indica l'insieme dei numeri relativi interi." },
            { category: "Definizioni", question: "I numeri relativi sono numeri dotati di:", options: ["Solo valore", "Segno (+ o ‚àí)", "Decimali", "Radice"], correct: 1, explanation: "I numeri relativi sono caratterizzati dal segno: positivo o negativo." },
            { category: "Definizioni", question: "Quale di questi NON appartiene all'insieme ‚Ñ§?", options: ["‚àí5", "0", "+3", "2,5"], correct: 3, explanation: "2,5 √® un numero decimale, non un intero. ‚Ñ§ contiene solo numeri interi." },
            { category: "Valore Assoluto e Opposti", question: "Quanto vale |‚àí8|?", options: ["‚àí8", "8", "0", "‚àí1"], correct: 1, explanation: "Il valore assoluto √® la distanza dallo zero: |‚àí8| = 8." },
            { category: "Valore Assoluto e Opposti", question: "Il valore assoluto di un numero √® sempre:", options: ["Negativo", "Positivo o zero", "Uguale al numero", "Zero"], correct: 1, explanation: "Il v.a. √® sempre ‚â• 0." },
            { category: "Valore Assoluto e Opposti", question: "Qual √® l'opposto di ‚àí5?", options: ["‚àí5", "+5", "0", "|‚àí5|"], correct: 1, explanation: "L'opposto di ‚àí5 √® +5 (stesso v.a., segno contrario)." },
            { category: "Valore Assoluto e Opposti", question: "Quanto fa a + (‚àía)?", options: ["2a", "‚àí2a", "0", "a"], correct: 2, explanation: "Un numero sommato al suo opposto d√† sempre 0." },
            { category: "Linea dei Numeri e Confronto", question: "Sulla linea dei numeri, andando verso destra:", options: ["I numeri diminuiscono", "I numeri aumentano", "I numeri restano uguali", "Si trovano solo negativi"], correct: 1, explanation: "Verso destra i numeri aumentano, verso sinistra diminuiscono." },
            { category: "Linea dei Numeri e Confronto", question: "Quale numero √® maggiore: ‚àí2 o ‚àí5?", options: ["‚àí5", "‚àí2", "Sono uguali", "Non si possono confrontare"], correct: 1, explanation: "‚àí2 > ‚àí5 perch√© |‚àí2| < |‚àí5|. Tra due negativi √® maggiore quello con v.a. minore." },
            { category: "Linea dei Numeri e Confronto", question: "Quale sequenza √® ordinata dal pi√π piccolo al pi√π grande?", options: ["‚àí2, ‚àí5, 0, +3", "‚àí5, ‚àí2, 0, +3", "+3, 0, ‚àí2, ‚àí5", "0, ‚àí2, ‚àí5, +3"], correct: 1, explanation: "‚àí7 < ‚àí5 < ‚àí2 < 0 < +1 < +3." }
        ];

        let viewedCards = { 1: new Set(), 2: new Set(), 3: new Set() };
        let selectedAnswers = {};
        let quizVerified = false;
        let categoryScores = { 
            'Definizioni': { correct: 0, total: 3 }, 
            'Valore Assoluto e Opposti': { correct: 0, total: 4 },
            'Linea dei Numeri e Confronto': { correct: 0, total: 3 }
        };

        function initCards() {
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', () => {
                    card.classList.toggle('expanded');
                    if (!card.classList.contains('viewed')) {
                        card.classList.add('viewed');
                        const cardNum = parseInt(card.dataset.card);
                        const phase = cardNum <= 2 ? 1 : 2;
                        viewedCards[phase].add(cardNum);
                        updateCounter(phase);
                    }
                });
            });
        }

        function initAccordions() {
            document.querySelectorAll('.accordion').forEach(acc => {
                acc.querySelector('.accordion-header').addEventListener('click', () => {
                    acc.classList.toggle('expanded');
                    if (!acc.classList.contains('viewed')) {
                        acc.classList.add('viewed');
                        viewedCards[3].add(parseInt(acc.dataset.acc));
                        updateCounter(3);
                    }
                });
            });
        }

        function updateCounter(phase) {
            const total = phase === 1 ? 2 : phase === 2 ? 2 : 4;
            document.getElementById(`counter${phase}`).textContent = viewedCards[phase].size;
            const nextBtn = document.getElementById(`next${phase}`);
            if (viewedCards[phase].size >= total) {
                nextBtn.disabled = false;
                nextBtn.onclick = () => goToPhase(phase + 1);
            }
        }

        function initQuiz() {
            const container = document.getElementById('quiz-container');
            let currentCat = '';
            quizData.forEach((q, idx) => {
                if (q.category !== currentCat) {
                    currentCat = q.category;
                    container.innerHTML += `<div class="category-header">${currentCat}</div>`;
                }
                container.innerHTML += `
                    <div class="quiz-question" data-q="${idx}">
                        <h3>${idx + 1}. ${q.question}</h3>
                        <div class="quiz-options">${q.options.map((o, i) => `<div class="quiz-option" data-opt="${i}">${o}</div>`).join('')}</div>
                        <div class="feedback" id="fb-${idx}"></div>
                    </div>`;
            });
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    if (quizVerified) return;
                    const q = opt.closest('.quiz-question');
                    q.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                    selectedAnswers[q.dataset.q] = parseInt(opt.dataset.opt);
                });
            });
        }

        function verifyQuiz() {
            const unanswered = quizData.filter((_, i) => selectedAnswers[i] === undefined);
            if (unanswered.length > 0) { alert(`Devi rispondere a tutte le domande! Ne mancano ${unanswered.length}.`); return; }
            quizVerified = true;
            let correct = 0;
            Object.keys(categoryScores).forEach(c => categoryScores[c].correct = 0);
            quizData.forEach((q, idx) => {
                const qEl = document.querySelector(`[data-q="${idx}"]`);
                const opts = qEl.querySelectorAll('.quiz-option');
                const fb = document.getElementById(`fb-${idx}`);
                opts.forEach(o => o.classList.add('disabled'));
                const selOpt = qEl.querySelector(`[data-opt="${selectedAnswers[idx]}"]`);
                const corrOpt = qEl.querySelector(`[data-opt="${q.correct}"]`);
                if (selectedAnswers[idx] === q.correct) {
                    correct++; categoryScores[q.category].correct++;
                    selOpt.classList.add('correct');
                    fb.className = 'feedback show correct'; fb.textContent = '‚úì Corretto! ' + q.explanation;
                } else {
                    selOpt.classList.add('wrong'); corrOpt.classList.add('correct');
                    fb.className = 'feedback show wrong'; fb.textContent = '‚úó Sbagliato. ' + q.explanation;
                }
            });
            document.getElementById('finalScore').textContent = correct;
            document.getElementById('verifyBtn').textContent = 'Vai al Ripasso ‚Üí';
            document.getElementById('verifyBtn').onclick = () => goToPhase(5);
            generateReview();
        }

        function generateReview() {
            const container = document.getElementById('review-container');
            container.innerHTML = '';
            const wrongByCat = {};
            quizData.forEach((q, idx) => {
                if (selectedAnswers[idx] !== q.correct) {
                    if (!wrongByCat[q.category]) wrongByCat[q.category] = [];
                    wrongByCat[q.category].push({ question: q.question, yours: q.options[selectedAnswers[idx]], correct: q.options[q.correct], expl: q.explanation });
                }
            });
            
            const reviewContent = {
                'Definizioni': '<ul style="margin:10px 0 0 20px;line-height:1.8;"><li><strong>‚Ñ§</strong> = insieme dei numeri relativi interi</li><li>I numeri relativi hanno un <strong>segno</strong> (+ o ‚àí)</li><li>‚Ñ§ = {..., ‚àí3, ‚àí2, ‚àí1, 0, +1, +2, +3, ...}</li></ul>',
                'Valore Assoluto e Opposti': '<ul style="margin:10px 0 0 20px;line-height:1.8;"><li><strong>Valore assoluto |a|</strong> = distanza dallo zero</li><li>Il v.a. √® sempre <strong>‚â• 0</strong></li><li><strong>Opposti:</strong> stesso v.a., segno contrario</li><li>a + (‚àía) = 0</li></ul>',
                'Linea dei Numeri e Confronto': '<ul style="margin:10px 0 0 20px;line-height:1.8;"><li>Verso <strong>destra</strong> i numeri aumentano</li><li>Ogni <strong>positivo > negativo</strong></li><li>Tra due negativi, √® maggiore quello con v.a. <strong>minore</strong></li></ul>'
            };
            
            for (const [cat, data] of Object.entries(categoryScores)) {
                const threshold = cat === 'Valore Assoluto e Opposti' ? 3 : 2;
                const mastered = data.correct >= threshold;
                let html = `<div class="review-section ${mastered ? 'mastered' : 'needs-review'}">
                    <h3>${mastered ? '‚úì Hai capito bene' : '‚ö† Da rivedere'}: ${cat}</h3>
                    <p><strong>Punteggio:</strong> ${data.correct}/${data.total}</p>`;
                if (mastered) {
                    html += `<p>Ottimo lavoro su questa sezione!</p>`;
                } else {
                    html += `<p><strong>Ricorda:</strong></p>${reviewContent[cat]}`;
                }
                if (wrongByCat[cat]) {
                    html += `<div style="margin-top:15px;"><strong>üìã Le tue risposte errate:</strong>`;
                    wrongByCat[cat].forEach(w => {
                        html += `<div class="wrong-item"><p><strong>Domanda:</strong> ${w.question}</p><p style="color:#e74c3c;">‚ùå Tua risposta: ${w.yours}</p><p style="color:#27ae60;">‚úì Risposta corretta: ${w.correct}</p><p style="font-size:0.9em;color:#666;">${w.expl}</p></div>`;
                    });
                    html += `</div>`;
                }
                html += `</div>`;
                container.innerHTML += html;
            }
        }

        function goToPhase(phase) {
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById(`phase${phase}`).classList.add('active');
            document.querySelectorAll('.progress-step').forEach((s, i) => {
                s.classList.remove('active');
                if (i + 1 < phase) s.classList.add('completed');
                if (i + 1 === phase) s.classList.add('active');
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.addEventListener('DOMContentLoaded', () => { initCards(); initAccordions(); initQuiz(); });
    </script>
</body>
</html>
