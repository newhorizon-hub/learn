<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operazioni con i Numeri Relativi - Percorso Didattico</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 1.8em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .progress-bar { display: flex; justify-content: center; gap: 10px; padding: 20px; background: #f8f9fa; flex-wrap: wrap; }
        .progress-step { width: 40px; height: 40px; border-radius: 50%; background: #e0e0e0; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #666; transition: all 0.3s; }
        .progress-step.active { background: #11998e; color: white; transform: scale(1.1); }
        .progress-step.completed { background: #27ae60; color: white; }
        .phase { display: none; padding: 30px; }
        .phase.active { display: block; }
        .phase-title { font-size: 1.4em; color: #333; margin-bottom: 10px; }
        .phase-subtitle { color: #666; margin-bottom: 20px; }
        .card-counter { background: #e0f2f1; padding: 10px 15px; border-radius: 10px; margin-bottom: 20px; color: #00695c; font-weight: 500; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .card { background: linear-gradient(145deg, #f5f7fa 0%, #e8ecf1 100%); border-radius: 15px; padding: 20px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .card.viewed { border-color: #11998e; background: linear-gradient(145deg, #e0f2f1 0%, #b2dfdb 100%); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card-title { font-weight: bold; color: #333; font-size: 1.05em; }
        .card-check { color: #11998e; font-size: 1.3em; opacity: 0; transition: opacity 0.3s; }
        .card.viewed .card-check { opacity: 1; }
        .card-hint { color: #888; font-size: 0.85em; }
        .card-content { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd; color: #444; line-height: 1.7; }
        .card.expanded .card-content { display: block; }
        .card.expanded .card-hint { display: none; }
        .formula-box { background: #fff3e0; border-left: 4px solid #ff9800; padding: 12px 15px; margin: 10px 0; border-radius: 0 8px 8px 0; font-family: 'Courier New', monospace; }
        .example-box { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 12px 15px; margin: 10px 0; border-radius: 0 8px 8px 0; }
        .warning-box { background: #ffebee; border-left: 4px solid #f44336; padding: 12px 15px; margin: 10px 0; border-radius: 0 8px 8px 0; }
        .positive { color: #27ae60; font-weight: bold; }
        .negative { color: #e74c3c; font-weight: bold; }
        .accordion { margin-bottom: 10px; border-radius: 10px; overflow: hidden; border: 1px solid #e0e0e0; }
        .accordion-header { background: #f5f7fa; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .accordion-header:hover { background: #e8ecf1; }
        .accordion.viewed .accordion-header { background: #e0f2f1; }
        .accordion-title { font-weight: 600; color: #333; }
        .accordion-icon { transition: transform 0.3s; }
        .accordion.expanded .accordion-icon { transform: rotate(180deg); }
        .accordion-content { display: none; padding: 20px; background: white; line-height: 1.7; }
        .accordion.expanded .accordion-content { display: block; }
        .quiz-question { background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .quiz-question h3 { color: #333; margin-bottom: 15px; font-size: 1.05em; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; }
        .quiz-option { padding: 12px 15px; background: white; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .quiz-option:hover:not(.disabled) { border-color: #11998e; background: #e0f2f1; }
        .quiz-option.selected { border-color: #11998e; background: #b2dfdb; }
        .quiz-option.correct { border-color: #27ae60; background: #e8f5e9; }
        .quiz-option.wrong { border-color: #e74c3c; background: #ffebee; }
        .quiz-option.disabled { pointer-events: none; }
        .feedback { padding: 10px 15px; border-radius: 8px; margin-top: 10px; display: none; }
        .feedback.show { display: block; }
        .feedback.correct { background: #e8f5e9; color: #2e7d32; }
        .feedback.wrong { background: #ffebee; color: #c62828; }
        .category-header { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 10px 15px; border-radius: 10px; margin: 20px 0 15px 0; font-weight: 600; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 25px; flex-wrap: wrap; gap: 10px; }
        .btn { padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(17,153,142,0.4); }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-success { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; }
        .score-display { text-align: center; padding: 30px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 15px; color: white; margin-bottom: 25px; }
        .score { font-size: 3em; font-weight: bold; }
        .score-label { font-size: 1.1em; opacity: 0.9; }
        .review-section { background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 15px; }
        .review-section h3 { color: #333; margin-bottom: 10px; }
        .review-section.mastered { border-left: 4px solid #27ae60; }
        .review-section.needs-review { border-left: 4px solid #ff9800; }
        .wrong-item { margin-top: 10px; padding: 12px; background: white; border-radius: 8px; border-left: 3px solid #e74c3c; }
        @media print { body { background: white; } .container { box-shadow: none; } .header, .progress-bar, .nav-buttons { display: none; } .phase { display: none !important; } #phase5 { display: block !important; } }
        @media (max-width: 600px) { .header h1 { font-size: 1.4em; } .phase { padding: 20px; } .cards-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ûï‚ûñ Operazioni con i Numeri Relativi</h1>
            <p>Addizione, sottrazione, moltiplicazione e divisione</p>
        </div>
        <div class="progress-bar">
            <div class="progress-step active">1</div>
            <div class="progress-step">2</div>
            <div class="progress-step">3</div>
            <div class="progress-step">4</div>
            <div class="progress-step">5</div>
        </div>

        <!-- FASE 1 -->
        <div id="phase1" class="phase active">
            <div class="phase-title">‚ûï Fase 1: Addizione e Sottrazione</div>
            <div class="phase-subtitle">Clicca su ogni card per scoprire le regole</div>
            <div class="card-counter">Card visualizzate: <span id="counter1">0</span>/4</div>
            <div class="cards-grid">
                <div class="card" data-card="1">
                    <div class="card-header"><span class="card-title">Addizione: Segni Concordi</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Regola:</strong> Somma i valori assoluti e <strong>mantieni il segno comune</strong>.
                        <div class="example-box">
                            <span class="positive">(+5)</span> + <span class="positive">(+3)</span> = <span class="positive">+8</span><br>
                            <span class="negative">(‚àí5)</span> + <span class="negative">(‚àí3)</span> = <span class="negative">‚àí8</span>
                        </div>
                        Entrambi positivi ‚Üí positivo<br>
                        Entrambi negativi ‚Üí negativo
                    </div>
                </div>
                <div class="card" data-card="2">
                    <div class="card-header"><span class="card-title">Addizione: Segni Discordi</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Regola:</strong> Sottrai i valori assoluti e prendi il <strong>segno del maggiore</strong>.
                        <div class="example-box">
                            <span class="positive">(+7)</span> + <span class="negative">(‚àí3)</span> = <span class="positive">+4</span> (|7| > |3|)<br>
                            <span class="positive">(+3)</span> + <span class="negative">(‚àí7)</span> = <span class="negative">‚àí4</span> (|7| > |3|)<br>
                            <span class="positive">(+5)</span> + <span class="negative">(‚àí5)</span> = 0 (opposti!)
                        </div>
                    </div>
                </div>
                <div class="card" data-card="3">
                    <div class="card-header"><span class="card-title">Sottrazione: la Regola d'Oro</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <div class="formula-box">a ‚àí b = a + (‚àíb)</div>
                        <strong>Sottrarre = addizionare l'opposto!</strong>
                        <div class="example-box">
                            (+7) ‚àí (+3) = (+7) + (‚àí3) = +4<br>
                            (‚àí5) ‚àí (+2) = (‚àí5) + (‚àí2) = ‚àí7<br>
                            (‚àí5) ‚àí (‚àí2) = (‚àí5) + (+2) = ‚àí3<br>
                            (+3) ‚àí (‚àí4) = (+3) + (+4) = +7
                        </div>
                    </div>
                </div>
                <div class="card" data-card="4">
                    <div class="card-header"><span class="card-title">‚ö†Ô∏è Sottrarre un Negativo</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Attenzione:</strong> Sottrarre un negativo = <strong>addizionare un positivo</strong>!
                        <div class="formula-box">a ‚àí (‚àíb) = a + b</div>
                        <div class="example-box">
                            (+3) ‚àí (‚àí4) = (+3) + (+4) = <span class="positive">+7</span><br>
                            (‚àí2) ‚àí (‚àí5) = (‚àí2) + (+5) = <span class="positive">+3</span>
                        </div>
                        I due segni ¬´‚àí¬ª si ¬´annullano¬ª diventando ¬´+¬ª!
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <div></div>
                <button class="btn btn-primary" id="next1" disabled>Prosegui ‚Üí</button>
            </div>
        </div>

        <!-- FASE 2 -->
        <div id="phase2" class="phase">
            <div class="phase-title">‚úñÔ∏è Fase 2: Moltiplicazione e Divisione</div>
            <div class="phase-subtitle">Clicca su ogni card per scoprire le regole</div>
            <div class="card-counter">Card visualizzate: <span id="counter2">0</span>/4</div>
            <div class="cards-grid">
                <div class="card" data-card="5">
                    <div class="card-header"><span class="card-title">Moltiplicazione</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Regola:</strong> Moltiplica i valori assoluti e applica la regola dei segni.
                        <div class="formula-box">Segni CONCORDI ‚Üí (+)<br>Segni DISCORDI ‚Üí (‚àí)</div>
                        <div class="example-box">
                            (+4) √ó (+3) = +12<br>
                            (‚àí4) √ó (‚àí3) = +12<br>
                            (+4) √ó (‚àí3) = ‚àí12<br>
                            (‚àí4) √ó (+3) = ‚àí12
                        </div>
                    </div>
                </div>
                <div class="card" data-card="6">
                    <div class="card-header"><span class="card-title">Divisione</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Regola:</strong> Dividi i valori assoluti, <strong>stessa regola</strong> della moltiplicazione.
                        <div class="example-box">
                            (+12) : (+4) = +3<br>
                            (‚àí12) : (‚àí4) = +3<br>
                            (+12) : (‚àí4) = ‚àí3<br>
                            (‚àí12) : (+4) = ‚àí3
                        </div>
                        <div class="warning-box">‚ö†Ô∏è Divisione per zero = <strong>IMPOSSIBILE!</strong></div>
                    </div>
                </div>
                <div class="card" data-card="7">
                    <div class="card-header"><span class="card-title">Pi√π Fattori</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Con pi√π fattori:</strong> conta i segni negativi!<br><br>
                        ‚Ä¢ Numero <strong>pari</strong> di ‚àí ‚Üí <span class="positive">positivo</span><br>
                        ‚Ä¢ Numero <strong>dispari</strong> di ‚àí ‚Üí <span class="negative">negativo</span>
                        <div class="example-box">
                            (‚àí2)√ó(‚àí3)√ó(+4) = +24 (2 segni ‚àí)<br>
                            (‚àí2)√ó(‚àí3)√ó(‚àí4) = ‚àí24 (3 segni ‚àí)
                        </div>
                    </div>
                </div>
                <div class="card" data-card="8">
                    <div class="card-header"><span class="card-title">Frazioni con Relativi</span><span class="card-check">‚úì</span></div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        Le frazioni seguono le <strong>stesse regole</strong>:
                        <div class="example-box">
                            ‚àí12/+4 = ‚àí3<br>
                            ‚àí12/‚àí4 = +3<br>
                            +12/‚àí4 = ‚àí3
                        </div>
                        <strong>Convenzione:</strong> Il segno si scrive <strong>davanti</strong> alla frazione:<br>
                        ‚àí3/5 = 3/‚àí5 = <strong>‚àí3/5</strong>
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(1)">‚Üê Indietro</button>
                <button class="btn btn-primary" id="next2" disabled>Prosegui ‚Üí</button>
            </div>
        </div>

        <!-- FASE 3 -->
        <div id="phase3" class="phase">
            <div class="phase-title">üìô Fase 3: Concetti Chiave</div>
            <div class="phase-subtitle">Espandi ogni sezione per approfondire</div>
            <div class="card-counter">Sezioni visualizzate: <span id="counter3">0</span>/5</div>

            <div class="accordion" data-acc="1">
                <div class="accordion-header"><span class="accordion-title">üìä Somma Algebrica</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    Con pi√π numeri da sommare/sottrarre:<br><br>
                    <strong>1.</strong> Trasforma le sottrazioni in addizioni dell'opposto<br>
                    <strong>2.</strong> Somma tutti i <span class="positive">positivi</span> insieme<br>
                    <strong>3.</strong> Somma tutti i <span class="negative">negativi</span> insieme (in v.a.)<br>
                    <strong>4.</strong> Fai la differenza, segno del gruppo maggiore
                    <div class="example-box">
                        (+8) + (‚àí3) ‚àí (+5) + (‚àí2) ‚àí (‚àí4) =<br>
                        = (+8) + (‚àí3) + (‚àí5) + (‚àí2) + (+4)<br>
                        Positivi: 8 + 4 = 12<br>
                        Negativi: 3 + 5 + 2 = 10<br>
                        Risultato: 12 ‚àí 10 = <strong>+2</strong>
                    </div>
                </div>
            </div>
            <div class="accordion" data-acc="2">
                <div class="accordion-header"><span class="accordion-title">üîÑ Trasformare le Sottrazioni</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    La regola <strong>a ‚àí b = a + (‚àíb)</strong> √® fondamentale!<br><br>
                    <strong>Perch√© funziona?</strong><br>
                    Sottrarre = ¬´togliere¬ª. Togliere +3 ‚â° aggiungere ‚àí3.<br><br>
                    <strong>Casi speciali:</strong><br>
                    ‚Ä¢ <strong>‚àí (+n)</strong> diventa <strong>+ (‚àín)</strong><br>
                    ‚Ä¢ <strong>‚àí (‚àín)</strong> diventa <strong>+ (+n)</strong><br><br>
                    Il doppio segno meno diventa pi√π!
                </div>
            </div>
            <div class="accordion" data-acc="3">
                <div class="accordion-header"><span class="accordion-title">üéØ Schema Riassuntivo</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    <strong>ADDIZIONE:</strong><br>
                    ‚Ä¢ Segni concordi ‚Üí somma v.a., mantieni segno<br>
                    ‚Ä¢ Segni discordi ‚Üí differenza v.a., segno del maggiore<br><br>
                    <strong>SOTTRAZIONE:</strong><br>
                    ‚Ä¢ Trasforma in addizione dell'opposto<br><br>
                    <strong>MOLTIPLICAZIONE/DIVISIONE:</strong><br>
                    ‚Ä¢ Segni concordi ‚Üí positivo<br>
                    ‚Ä¢ Segni discordi ‚Üí negativo
                </div>
            </div>
            <div class="accordion" data-acc="4">
                <div class="accordion-header"><span class="accordion-title">üßÆ Propriet√† dello Zero</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    <strong>Lo zero nelle operazioni:</strong><br><br>
                    ‚Ä¢ a + 0 = a (elemento neutro)<br>
                    ‚Ä¢ a ‚àí 0 = a<br>
                    ‚Ä¢ a √ó 0 = 0<br>
                    ‚Ä¢ 0 : a = 0 (se a ‚â† 0)<br>
                    ‚Ä¢ a : 0 = <strong>IMPOSSIBILE!</strong>
                </div>
            </div>
            <div class="accordion" data-acc="5">
                <div class="accordion-header"><span class="accordion-title">‚ö†Ô∏è Errori Comuni</span><span class="accordion-icon">‚ñº</span></div>
                <div class="accordion-content">
                    <div class="warning-box">
                        <strong>Errore 1:</strong> Nella sottrazione<br>
                        (‚àí5) ‚àí (‚àí3) ‚â† ‚àí8<br>
                        ‚úì Corretto: (‚àí5) ‚àí (‚àí3) = (‚àí5) + (+3) = ‚àí2
                    </div>
                    <div class="warning-box">
                        <strong>Errore 2:</strong> Nell'addizione segni discordi<br>
                        (+3) + (‚àí7) ‚â† +4<br>
                        ‚úì Corretto: (+3) + (‚àí7) = ‚àí4
                    </div>
                    <div class="warning-box">
                        <strong>Errore 3:</strong> Nella moltiplicazione<br>
                        (‚àí2) √ó (‚àí3) ‚â† ‚àí6<br>
                        ‚úì Corretto: (‚àí2) √ó (‚àí3) = +6
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(2)">‚Üê Indietro</button>
                <button class="btn btn-primary" id="next3" disabled>Vai alla Verifica ‚Üí</button>
            </div>
        </div>

        <!-- FASE 4 -->
        <div id="phase4" class="phase">
            <div class="phase-title">üìù Fase 4: Verifica delle Conoscenze</div>
            <div class="phase-subtitle">Rispondi a tutte le domande, poi clicca "Verifica Risposte"</div>
            <div id="quiz-container"></div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(3)">‚Üê Indietro</button>
                <button class="btn btn-success" id="verifyBtn" onclick="verifyQuiz()">‚úì Verifica Risposte</button>
            </div>
        </div>

        <!-- FASE 5 -->
        <div id="phase5" class="phase">
            <div class="phase-title">üìä Fase 5: Ripasso Personalizzato</div>
            <div class="phase-subtitle">Riepilogo basato sui tuoi risultati</div>
            <div class="score-display">
                <div class="score"><span id="finalScore">0</span>/10</div>
                <div class="score-label">Risposte corrette</div>
            </div>
            <div id="review-container"></div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(4)">‚Üê Rivedi Errori</button>
                <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Stampa Ripasso</button>
            </div>
        </div>
    </div>

    <script>
        const quizData = [
            { category: "Addizione e Sottrazione", question: "Quanto fa (+8) + (‚àí3)?", options: ["+11", "+5", "‚àí5", "‚àí11"], correct: 1, explanation: "Segni discordi: 8 ‚àí 3 = 5, segno del maggiore (+) ‚Üí +5" },
            { category: "Addizione e Sottrazione", question: "Quanto fa (‚àí6) + (‚àí4)?", options: ["+10", "‚àí10", "+2", "‚àí2"], correct: 1, explanation: "Segni concordi: somma v.a. = 10, mantieni segno (‚àí) ‚Üí ‚àí10" },
            { category: "Addizione e Sottrazione", question: "Quanto fa (+5) ‚àí (+8)?", options: ["+13", "+3", "‚àí3", "‚àí13"], correct: 2, explanation: "(+5) ‚àí (+8) = (+5) + (‚àí8) = ‚àí3" },
            { category: "Addizione e Sottrazione", question: "Quanto fa (‚àí4) ‚àí (‚àí7)?", options: ["+11", "‚àí11", "+3", "‚àí3"], correct: 2, explanation: "(‚àí4) ‚àí (‚àí7) = (‚àí4) + (+7) = +3" },
            { category: "Addizione e Sottrazione", question: "a ‚àí (‚àíb) equivale a:", options: ["a ‚àí b", "a + b", "‚àía + b", "‚àía ‚àí b"], correct: 1, explanation: "Sottrarre un negativo = addizionare un positivo!" },
            { category: "Moltiplicazione e Divisione", question: "Quanto fa (‚àí5) √ó (‚àí4)?", options: ["+20", "‚àí20", "+9", "‚àí9"], correct: 0, explanation: "Segni concordi ‚Üí positivo: (‚àí5) √ó (‚àí4) = +20" },
            { category: "Moltiplicazione e Divisione", question: "Quanto fa (+15) : (‚àí3)?", options: ["+5", "‚àí5", "+45", "‚àí45"], correct: 1, explanation: "Segni discordi ‚Üí negativo: (+15) : (‚àí3) = ‚àí5" },
            { category: "Moltiplicazione e Divisione", question: "Quanto fa (‚àí2) √ó (‚àí3) √ó (‚àí1)?", options: ["+6", "‚àí6", "+5", "‚àí5"], correct: 1, explanation: "3 segni negativi (dispari) ‚Üí negativo: = ‚àí6" },
            { category: "Moltiplicazione e Divisione", question: "Quanto fa (‚àí18) : (‚àí6)?", options: ["+3", "‚àí3", "+12", "‚àí12"], correct: 0, explanation: "Segni concordi ‚Üí positivo: (‚àí18) : (‚àí6) = +3" },
            { category: "Moltiplicazione e Divisione", question: "Quanto vale la frazione ‚àí12/(‚àí4)?", options: ["+3", "‚àí3", "+16", "‚àí16"], correct: 0, explanation: "Segni concordi ‚Üí positivo: ‚àí12/(‚àí4) = +3" }
        ];

        let viewedCards = { 1: new Set(), 2: new Set(), 3: new Set() };
        let selectedAnswers = {};
        let quizVerified = false;
        let categoryScores = { 'Addizione e Sottrazione': { correct: 0, total: 5 }, 'Moltiplicazione e Divisione': { correct: 0, total: 5 } };

        function initCards() {
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', () => {
                    card.classList.toggle('expanded');
                    if (!card.classList.contains('viewed')) {
                        card.classList.add('viewed');
                        const cardNum = parseInt(card.dataset.card);
                        const phase = cardNum <= 4 ? 1 : 2;
                        viewedCards[phase].add(cardNum);
                        updateCounter(phase);
                    }
                });
            });
        }

        function initAccordions() {
            document.querySelectorAll('.accordion').forEach(acc => {
                acc.querySelector('.accordion-header').addEventListener('click', () => {
                    acc.classList.toggle('expanded');
                    if (!acc.classList.contains('viewed')) {
                        acc.classList.add('viewed');
                        viewedCards[3].add(parseInt(acc.dataset.acc));
                        updateCounter(3);
                    }
                });
            });
        }

        function updateCounter(phase) {
            const total = phase === 1 ? 4 : phase === 2 ? 4 : 5;
            document.getElementById(`counter${phase}`).textContent = viewedCards[phase].size;
            const nextBtn = document.getElementById(`next${phase}`);
            if (viewedCards[phase].size >= total) {
                nextBtn.disabled = false;
                nextBtn.onclick = () => goToPhase(phase + 1);
            }
        }

        function initQuiz() {
            const container = document.getElementById('quiz-container');
            let currentCat = '';
            quizData.forEach((q, idx) => {
                if (q.category !== currentCat) {
                    currentCat = q.category;
                    container.innerHTML += `<div class="category-header">${currentCat}</div>`;
                }
                container.innerHTML += `
                    <div class="quiz-question" data-q="${idx}">
                        <h3>${idx + 1}. ${q.question}</h3>
                        <div class="quiz-options">${q.options.map((o, i) => `<div class="quiz-option" data-opt="${i}">${o}</div>`).join('')}</div>
                        <div class="feedback" id="fb-${idx}"></div>
                    </div>`;
            });
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    if (quizVerified) return;
                    const q = opt.closest('.quiz-question');
                    q.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                    selectedAnswers[q.dataset.q] = parseInt(opt.dataset.opt);
                });
            });
        }

        function verifyQuiz() {
            const unanswered = quizData.filter((_, i) => selectedAnswers[i] === undefined);
            if (unanswered.length > 0) { alert(`Devi rispondere a tutte le domande! Ne mancano ${unanswered.length}.`); return; }
            quizVerified = true;
            let correct = 0;
            Object.keys(categoryScores).forEach(c => categoryScores[c].correct = 0);
            quizData.forEach((q, idx) => {
                const qEl = document.querySelector(`[data-q="${idx}"]`);
                const opts = qEl.querySelectorAll('.quiz-option');
                const fb = document.getElementById(`fb-${idx}`);
                opts.forEach(o => o.classList.add('disabled'));
                const selOpt = qEl.querySelector(`[data-opt="${selectedAnswers[idx]}"]`);
                const corrOpt = qEl.querySelector(`[data-opt="${q.correct}"]`);
                if (selectedAnswers[idx] === q.correct) {
                    correct++; categoryScores[q.category].correct++;
                    selOpt.classList.add('correct');
                    fb.className = 'feedback show correct'; fb.textContent = '‚úì Corretto! ' + q.explanation;
                } else {
                    selOpt.classList.add('wrong'); corrOpt.classList.add('correct');
                    fb.className = 'feedback show wrong'; fb.textContent = '‚úó Sbagliato. ' + q.explanation;
                }
            });
            document.getElementById('finalScore').textContent = correct;
            document.getElementById('verifyBtn').textContent = 'Vai al Ripasso ‚Üí';
            document.getElementById('verifyBtn').onclick = () => goToPhase(5);
            generateReview();
        }

        function generateReview() {
            const container = document.getElementById('review-container');
            container.innerHTML = '';
            const wrongByCat = {};
            quizData.forEach((q, idx) => {
                if (selectedAnswers[idx] !== q.correct) {
                    if (!wrongByCat[q.category]) wrongByCat[q.category] = [];
                    wrongByCat[q.category].push({ question: q.question, yours: q.options[selectedAnswers[idx]], correct: q.options[q.correct], expl: q.explanation });
                }
            });
            for (const [cat, data] of Object.entries(categoryScores)) {
                const mastered = data.correct >= 3;
                let html = `<div class="review-section ${mastered ? 'mastered' : 'needs-review'}">
                    <h3>${mastered ? '‚úì Hai capito bene' : '‚ö† Da rivedere'}: ${cat}</h3>
                    <p><strong>Punteggio:</strong> ${data.correct}/${data.total}</p>`;
                if (mastered) {
                    html += `<p>Ottimo lavoro su questa sezione!</p>`;
                } else {
                    html += cat.includes('Addizione') ?
                        `<p><strong>Ricorda:</strong></p><ul style="margin:10px 0 0 20px;line-height:1.8;"><li>Segni concordi: somma v.a., mantieni segno</li><li>Segni discordi: differenza v.a., segno del maggiore</li><li><strong>a ‚àí b = a + (‚àíb)</strong></li></ul>` :
                        `<p><strong>Ricorda:</strong></p><ul style="margin:10px 0 0 20px;line-height:1.8;"><li>Segni concordi ‚Üí <strong>positivo</strong></li><li>Segni discordi ‚Üí <strong>negativo</strong></li><li>Pi√π fattori: conta i segni ‚àí</li></ul>`;
                }
                if (wrongByCat[cat]) {
                    html += `<div style="margin-top:15px;"><strong>üìã Le tue risposte errate:</strong>`;
                    wrongByCat[cat].forEach(w => {
                        html += `<div class="wrong-item"><p><strong>Domanda:</strong> ${w.question}</p><p style="color:#e74c3c;">‚ùå Tua risposta: ${w.yours}</p><p style="color:#27ae60;">‚úì Risposta corretta: ${w.correct}</p><p style="font-size:0.9em;color:#666;">${w.expl}</p></div>`;
                    });
                    html += `</div>`;
                }
                html += `</div>`;
                container.innerHTML += html;
            }
        }

        function goToPhase(phase) {
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById(`phase${phase}`).classList.add('active');
            document.querySelectorAll('.progress-step').forEach((s, i) => {
                s.classList.remove('active');
                if (i + 1 < phase) s.classList.add('completed');
                if (i + 1 === phase) s.classList.add('active');
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.addEventListener('DOMContentLoaded', () => { initCards(); initAccordions(); initQuiz(); });
    </script>
</body>
</html>
