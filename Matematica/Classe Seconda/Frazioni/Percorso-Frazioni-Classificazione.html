<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Percorso Didattico: Le Frazioni e la Classificazione</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 1.8em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .progress-bar {
            display: flex;
            justify-content: center;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            flex-wrap: wrap;
            gap: 10px;
        }
        .progress-step {
            width: 40px; height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6c757d;
            transition: all 0.3s;
        }
        .progress-step.active {
            background: #3498db;
            color: white;
            transform: scale(1.1);
        }
        .progress-step.completed {
            background: #27ae60;
            color: white;
        }
        .phase { display: none; padding: 30px; }
        .phase.active { display: block; }
        .phase-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .phase-subtitle {
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        .card-counter {
            background: #e8f4f8;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95em;
            color: #2980b9;
        }
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .card {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            position: relative;
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .card.viewed { border-color: #27ae60; background: linear-gradient(145deg, #e8f5e9, #c8e6c9); }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .card-title { font-weight: bold; color: #2c3e50; font-size: 1.1em; }
        .card-check {
            width: 24px; height: 24px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }
        .card.viewed .card-check { background: #27ae60; }
        .card-content {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
            color: #495057;
            line-height: 1.6;
        }
        .card.expanded .card-content { display: block; }
        .card-hint { font-size: 0.85em; color: #7f8c8d; margin-top: 8px; }
        .accordion {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .accordion-header {
            padding: 18px;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        .accordion-header:hover { background: #e9ecef; }
        .accordion.viewed .accordion-header { background: #e8f5e9; }
        .accordion-title { font-weight: 600; color: #2c3e50; }
        .accordion-icon { transition: transform 0.3s; font-size: 1.2em; }
        .accordion.expanded .accordion-icon { transform: rotate(180deg); }
        .accordion-content {
            display: none;
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            line-height: 1.7;
        }
        .accordion.expanded .accordion-content { display: block; }
        .quiz-question {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .quiz-question.answered-correct { background: #d4edda; border: 2px solid #27ae60; }
        .quiz-question.answered-wrong { background: #f8d7da; border: 2px solid #e74c3c; }
        .question-header {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        .question-number {
            background: #3498db;
            color: white;
            width: 30px; height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        .question-text { color: #2c3e50; font-size: 1.05em; line-height: 1.5; }
        .question-category {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-bottom: 8px;
        }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .option {
            padding: 12px 15px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .option:hover:not(.disabled) { border-color: #3498db; background: #e8f4f8; }
        .option.selected { border-color: #3498db; background: #e8f4f8; }
        .option.correct { border-color: #27ae60; background: #d4edda; }
        .option.wrong { border-color: #e74c3c; background: #f8d7da; }
        .option.disabled { cursor: not-allowed; opacity: 0.7; }
        .option-letter {
            width: 28px; height: 28px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        .option.selected .option-letter { background: #3498db; color: white; }
        .option.correct .option-letter { background: #27ae60; color: white; }
        .option.wrong .option-letter { background: #e74c3c; color: white; }
        .feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }
        .feedback.show { display: block; }
        .feedback.correct { background: #d4edda; color: #155724; }
        .feedback.wrong { background: #f8d7da; color: #721c24; }
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(52,152,219,0.4); }
        .btn-primary:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
            color: white;
        }
        .btn-success:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(39,174,96,0.4); }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .review-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .review-section h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .review-section.needs-review { background: #fff3cd; border-left: 4px solid #ffc107; }
        .review-section.mastered { background: #d4edda; border-left: 4px solid #27ae60; }
        .score-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            margin-bottom: 25px;
        }
        .score-display .score { font-size: 3em; font-weight: bold; }
        .score-display .score-label { font-size: 1.2em; opacity: 0.9; }
        .formula-box {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-size: 1.1em;
        }
        .example-box {
            background: #f0f0f0;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        .highlight { color: #e74c3c; font-weight: bold; }
        .fraction-display {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 8px;
            vertical-align: middle;
        }
        .fraction-display .num { border-bottom: 2px solid #2c3e50; padding: 0 5px; }
        .fraction-display .den { padding: 0 5px; }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; }
            .header, .progress-bar, .nav-buttons, .btn { display: none !important; }
            .phase { display: none !important; }
            #phase5 { display: block !important; }
            .review-section { break-inside: avoid; }
        }
        @media (max-width: 600px) {
            .header h1 { font-size: 1.4em; }
            .phase { padding: 20px; }
            .cards-grid { grid-template-columns: 1fr; }
            .btn { width: 100%; justify-content: center; }
            .nav-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìê Le Frazioni e la Classificazione</h1>
            <p>Percorso didattico interattivo</p>
        </div>

        <div class="progress-bar">
            <div class="progress-step active" data-step="1">1</div>
            <div class="progress-step" data-step="2">2</div>
            <div class="progress-step" data-step="3">3</div>
            <div class="progress-step" data-step="4">4</div>
            <div class="progress-step" data-step="5">5</div>
        </div>

        <!-- FASE 1: Che cos'√® una Frazione -->
        <div id="phase1" class="phase active">
            <div class="phase-title">üìò Fase 1: Che cos'√® una Frazione</div>
            <div class="phase-subtitle">Clicca su ogni card per scoprire i concetti fondamentali</div>
            <div class="card-counter">Card visualizzate: <span id="counter1">0</span>/4</div>
            
            <div class="cards-grid">
                <div class="card" data-card="1">
                    <div class="card-header">
                        <span class="card-title">Definizione di Frazione</span>
                        <span class="card-check">‚úì</span>
                    </div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        Una <strong>frazione</strong> rappresenta una o pi√π parti uguali in cui √® stato diviso un intero.<br><br>
                        L'<strong>unit√† frazionaria</strong> √® ciascuna delle parti uguali in cui viene diviso l'intero.
                        <div class="example-box">
                            Se divido una torta in 4 parti uguali, ogni fetta √® <span class="fraction-display"><span class="num">1</span><span class="den">4</span></span> della torta.
                        </div>
                    </div>
                </div>

                <div class="card" data-card="2">
                    <div class="card-header">
                        <span class="card-title">Struttura della Frazione</span>
                        <span class="card-check">‚úì</span>
                    </div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <div class="formula-box">
                            <span class="fraction-display"><span class="num"><strong>Numeratore (NUM)</strong></span><span class="den"><strong>Denominatore (DEN)</strong></span></span>
                        </div>
                        <strong>Numeratore:</strong> indica quante parti si considerano<br><br>
                        <strong>Denominatore:</strong> indica in quante parti √® diviso l'intero
                        <div class="example-box">
                            In <span class="fraction-display"><span class="num">3</span><span class="den">4</span></span>: NUM = 3 (parti prese), DEN = 4 (parti totali)
                        </div>
                    </div>
                </div>

                <div class="card" data-card="3">
                    <div class="card-header">
                        <span class="card-title">Frazioni Equivalenti</span>
                        <span class="card-check">‚úì</span>
                    </div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        Due frazioni sono <strong>equivalenti</strong> quando rappresentano la <strong>stessa quantit√†</strong>.<br><br>
                        <strong>Propriet√† Invariantiva:</strong> moltiplicando o dividendo NUM e DEN per lo stesso numero (‚â†0), si ottiene una frazione equivalente.
                        <div class="example-box">
                            <span class="fraction-display"><span class="num">1</span><span class="den">2</span></span> = <span class="fraction-display"><span class="num">2</span><span class="den">4</span></span> = <span class="fraction-display"><span class="num">4</span><span class="den">8</span></span> (stessa quantit√†!)
                        </div>
                    </div>
                </div>

                <div class="card" data-card="4">
                    <div class="card-header">
                        <span class="card-title">Frazione Complementare</span>
                        <span class="card-check">‚úì</span>
                    </div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        La <strong>frazione complementare</strong> di una frazione propria √® la parte mancante per raggiungere l'intero.<br><br>
                        La somma di una frazione e della sua complementare √® sempre uguale a 1.
                        <div class="formula-box">
                            Complementare di <span class="fraction-display"><span class="num">a</span><span class="den">b</span></span> ‚Üí <span class="fraction-display"><span class="num">b ‚àí a</span><span class="den">b</span></span>
                        </div>
                        <div class="example-box">
                            Complementare di <span class="fraction-display"><span class="num">3</span><span class="den">7</span></span> √® <span class="fraction-display"><span class="num">4</span><span class="den">7</span></span> perch√© <span class="fraction-display"><span class="num">3</span><span class="den">7</span></span> + <span class="fraction-display"><span class="num">4</span><span class="den">7</span></span> = 1
                        </div>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <div></div>
                <button class="btn btn-primary" id="next1" disabled>Prosegui ‚Üí</button>
            </div>
        </div>

        <!-- FASE 2: Classificazione delle Frazioni -->
        <div id="phase2" class="phase">
            <div class="phase-title">üìó Fase 2: Classificazione delle Frazioni</div>
            <div class="phase-subtitle">Clicca su ogni card per scoprire i tipi di frazione</div>
            <div class="card-counter">Card visualizzate: <span id="counter2">0</span>/4</div>
            
            <div class="cards-grid">
                <div class="card" data-card="5">
                    <div class="card-header">
                        <span class="card-title">Frazioni PROPRIE</span>
                        <span class="card-check">‚úì</span>
                    </div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Regola:</strong> NUM &lt; DEN (numeratore minore del denominatore)<br><br>
                        <strong>Valore:</strong> sempre minore di 1<br><br>
                        Rappresentano una <strong>parte</strong> dell'intero (meno di una torta intera).
                        <div class="example-box">
                            <span class="fraction-display"><span class="num">1</span><span class="den">2</span></span>, <span class="fraction-display"><span class="num">3</span><span class="den">4</span></span>, <span class="fraction-display"><span class="num">5</span><span class="den">8</span></span> ‚Üí tutte &lt; 1
                        </div>
                    </div>
                </div>

                <div class="card" data-card="6">
                    <div class="card-header">
                        <span class="card-title">Frazioni IMPROPRIE</span>
                        <span class="card-check">‚úì</span>
                    </div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Regola:</strong> NUM &gt; DEN (numeratore maggiore del denominatore)<br><br>
                        <strong>Valore:</strong> sempre maggiore di 1<br><br>
                        Rappresentano <strong>pi√π di un intero</strong> (pi√π di una torta intera).
                        <div class="example-box">
                            <span class="fraction-display"><span class="num">5</span><span class="den">4</span></span>, <span class="fraction-display"><span class="num">7</span><span class="den">3</span></span>, <span class="fraction-display"><span class="num">9</span><span class="den">2</span></span> ‚Üí tutte &gt; 1
                        </div>
                    </div>
                </div>

                <div class="card" data-card="7">
                    <div class="card-header">
                        <span class="card-title">Frazioni APPARENTI</span>
                        <span class="card-check">‚úì</span>
                    </div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Regola:</strong> NUM √® uguale o multiplo del DEN<br><br>
                        <strong>Valore:</strong> sempre un numero intero (1, 2, 3...)<br><br>
                        Rappresentano <strong>esattamente</strong> 1 o pi√π interi (torte complete, senza avanzi).
                        <div class="example-box">
                            <span class="fraction-display"><span class="num">4</span><span class="den">4</span></span> = 1, <span class="fraction-display"><span class="num">6</span><span class="den">3</span></span> = 2, <span class="fraction-display"><span class="num">8</span><span class="den">2</span></span> = 4
                        </div>
                    </div>
                </div>

                <div class="card" data-card="8">
                    <div class="card-header">
                        <span class="card-title">Come Riconoscerle</span>
                        <span class="card-check">‚úì</span>
                    </div>
                    <div class="card-hint">Clicca per espandere</div>
                    <div class="card-content">
                        <strong>Schema rapido:</strong> confronta NUM e DEN<br><br>
                        ‚Ä¢ NUM &lt; DEN ‚Üí <strong>PROPRIA</strong> (valore &lt; 1)<br><br>
                        ‚Ä¢ NUM &gt; DEN ‚Üí <strong>IMPROPRIA</strong> (valore &gt; 1)<br><br>
                        ‚Ä¢ NUM multiplo di DEN ‚Üí <strong>APPARENTE</strong> (valore intero)
                        <div class="example-box">
                            <span class="fraction-display"><span class="num">7</span><span class="den">5</span></span>: 7 &gt; 5 ‚Üí impropria
                        </div>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(1)">‚Üê Indietro</button>
                <button class="btn btn-primary" id="next2" disabled>Prosegui ‚Üí</button>
            </div>
        </div>

        <!-- FASE 3: Concetti Chiave -->
        <div id="phase3" class="phase">
            <div class="phase-title">üìô Fase 3: Concetti Chiave</div>
            <div class="phase-subtitle">Espandi ogni sezione per approfondire</div>
            <div class="card-counter">Sezioni visualizzate: <span id="counter3">0</span>/5</div>

            <div class="accordion" data-acc="1">
                <div class="accordion-header">
                    <span class="accordion-title">üîÑ Propriet√† Invariantiva</span>
                    <span class="accordion-icon">‚ñº</span>
                </div>
                <div class="accordion-content">
                    La <strong>propriet√† invariantiva</strong> afferma che moltiplicando o dividendo numeratore e denominatore per lo stesso numero (diverso da zero), il valore della frazione non cambia.<br><br>
                    <strong>Moltiplicando:</strong> <span class="fraction-display"><span class="num">3</span><span class="den">7</span></span> = <span class="fraction-display"><span class="num">3 √ó 2</span><span class="den">7 √ó 2</span></span> = <span class="fraction-display"><span class="num">6</span><span class="den">14</span></span><br><br>
                    <strong>Dividendo:</strong> <span class="fraction-display"><span class="num">10</span><span class="den">15</span></span> = <span class="fraction-display"><span class="num">10 : 5</span><span class="den">15 : 5</span></span> = <span class="fraction-display"><span class="num">2</span><span class="den">3</span></span>
                </div>
            </div>

            <div class="accordion" data-acc="2">
                <div class="accordion-header">
                    <span class="accordion-title">üñºÔ∏è Rappresentazione Grafica</span>
                    <span class="accordion-icon">‚ñº</span>
                </div>
                <div class="accordion-content">
                    Le frazioni possono essere rappresentate graficamente con:<br><br>
                    ‚Ä¢ <strong>Torte/Cerchi:</strong> divisi in spicchi uguali<br>
                    ‚Ä¢ <strong>Rettangoli:</strong> divisi in parti uguali<br>
                    ‚Ä¢ <strong>Segmenti:</strong> divisi in parti uguali<br><br>
                    La rappresentazione grafica aiuta a capire visivamente il valore della frazione e a confrontare frazioni diverse.
                </div>
            </div>

            <div class="accordion" data-acc="3">
                <div class="accordion-header">
                    <span class="accordion-title">üî¢ Valore Decimale</span>
                    <span class="accordion-icon">‚ñº</span>
                </div>
                <div class="accordion-content">
                    Ogni frazione pu√≤ essere trasformata in numero decimale dividendo NUM : DEN<br><br>
                    ‚Ä¢ <strong>Proprie:</strong> risultato 0,... (es. <span class="fraction-display"><span class="num">3</span><span class="den">4</span></span> = 0,75)<br><br>
                    ‚Ä¢ <strong>Improprie:</strong> risultato 1,... o 2,... (es. <span class="fraction-display"><span class="num">5</span><span class="den">4</span></span> = 1,25)<br><br>
                    ‚Ä¢ <strong>Apparenti:</strong> risultato intero (es. <span class="fraction-display"><span class="num">6</span><span class="den">3</span></span> = 2)
                </div>
            </div>

            <div class="accordion" data-acc="4">
                <div class="accordion-header">
                    <span class="accordion-title">‚ûó Linea di Frazione</span>
                    <span class="accordion-icon">‚ñº</span>
                </div>
                <div class="accordion-content">
                    La <strong>linea di frazione</strong> (o vincolo) separa il numeratore dal denominatore e indica un'operazione di divisione.<br><br>
                    <span class="fraction-display"><span class="num">a</span><span class="den">b</span></span> significa a : b<br><br>
                    Per questo motivo il denominatore non pu√≤ mai essere zero (divisione per zero impossibile).
                </div>
            </div>

            <div class="accordion" data-acc="5">
                <div class="accordion-header">
                    <span class="accordion-title">üåç Applicazioni Pratiche</span>
                    <span class="accordion-icon">‚ñº</span>
                </div>
                <div class="accordion-content">
                    Le frazioni si usano nella vita quotidiana:<br><br>
                    ‚Ä¢ <strong>Cucina:</strong> mezza tazza, un quarto di litro<br>
                    ‚Ä¢ <strong>Tempo:</strong> mezz'ora = <span class="fraction-display"><span class="num">1</span><span class="den">2</span></span> ora, un quarto d'ora = <span class="fraction-display"><span class="num">1</span><span class="den">4</span></span> ora<br>
                    ‚Ä¢ <strong>Sconti:</strong> sconto del 50% = met√† del prezzo<br>
                    ‚Ä¢ <strong>Musica:</strong> note (semibreve, minima, semiminima...)
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(2)">‚Üê Indietro</button>
                <button class="btn btn-primary" id="next3" disabled>Vai alla Verifica ‚Üí</button>
            </div>
        </div>

        <!-- FASE 4: Verifica -->
        <div id="phase4" class="phase">
            <div class="phase-title">üìù Fase 4: Verifica delle Conoscenze</div>
            <div class="phase-subtitle">Rispondi a tutte le domande, poi clicca "Verifica Risposte"</div>

            <div id="quiz-container"></div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(3)">‚Üê Indietro</button>
                <button class="btn btn-success" id="verifyBtn" onclick="verifyQuiz()">‚úì Verifica Risposte</button>
            </div>
        </div>

        <!-- FASE 5: Ripasso -->
        <div id="phase5" class="phase">
            <div class="phase-title">üìä Fase 5: Ripasso Personalizzato</div>
            <div class="phase-subtitle">Ecco il tuo riepilogo basato sui risultati della verifica</div>

            <div class="score-display">
                <div class="score"><span id="finalScore">0</span>/10</div>
                <div class="score-label">Risposte corrette</div>
            </div>

            <div id="review-container"></div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToPhase(4)">‚Üê Rivedi Errori</button>
                <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Stampa Ripasso</button>
                <button class="btn btn-success" onclick="location.reload()">üîÑ Ricomincia</button>
            </div>
        </div>
    </div>

    <script>
        // Quiz data
        const quizData = [
            // Categoria 1: Definizioni e Struttura (5 domande)
            {
                category: "Definizioni e Struttura",
                question: "Cosa indica il denominatore di una frazione?",
                options: [
                    "Quante parti si considerano",
                    "In quante parti √® diviso l'intero",
                    "Il valore della frazione",
                    "Il risultato della divisione"
                ],
                correct: 1,
                explanation: "Il denominatore indica in quante parti uguali √® stato diviso l'intero."
            },
            {
                category: "Definizioni e Struttura",
                question: "Cosa indica il numeratore di una frazione?",
                options: [
                    "In quante parti √® diviso l'intero",
                    "Il valore decimale",
                    "Quante parti si considerano",
                    "Se la frazione √® propria o impropria"
                ],
                correct: 2,
                explanation: "Il numeratore indica quante parti dell'intero vengono considerate."
            },
            {
                category: "Definizioni e Struttura",
                question: "Due frazioni sono equivalenti quando:",
                options: [
                    "Hanno lo stesso numeratore",
                    "Hanno lo stesso denominatore",
                    "Rappresentano la stessa quantit√†",
                    "Sono entrambe proprie"
                ],
                correct: 2,
                explanation: "Due frazioni equivalenti rappresentano la stessa quantit√†, pur avendo numeri diversi."
            },
            {
                category: "Definizioni e Struttura",
                question: "Qual √® la frazione complementare di 2/5?",
                options: [
                    "5/2",
                    "2/5",
                    "3/5",
                    "1/5"
                ],
                correct: 2,
                explanation: "La complementare √® la parte mancante per arrivare a 1: 2/5 + 3/5 = 5/5 = 1."
            },
            {
                category: "Definizioni e Struttura",
                question: "Applicando la propriet√† invariantiva a 3/4, quale frazione equivalente ottieni moltiplicando per 3?",
                options: [
                    "6/8",
                    "9/12",
                    "3/12",
                    "9/4"
                ],
                correct: 1,
                explanation: "Moltiplicando NUM e DEN per 3: (3√ó3)/(4√ó3) = 9/12."
            },
            // Categoria 2: Classificazione (5 domande)
            {
                category: "Classificazione delle Frazioni",
                question: "La frazione 7/4 √®:",
                options: [
                    "Propria",
                    "Impropria",
                    "Apparente",
                    "Equivalente"
                ],
                correct: 1,
                explanation: "√à impropria perch√© NUM (7) > DEN (4), quindi il suo valore √® maggiore di 1."
            },
            {
                category: "Classificazione delle Frazioni",
                question: "Quale tra queste √® una frazione apparente?",
                options: [
                    "3/5",
                    "7/4",
                    "8/4",
                    "5/8"
                ],
                correct: 2,
                explanation: "8/4 √® apparente perch√© 8 √® multiplo di 4. Infatti 8/4 = 2 (numero intero)."
            },
            {
                category: "Classificazione delle Frazioni",
                question: "Una frazione propria ha sempre valore:",
                options: [
                    "Maggiore di 1",
                    "Uguale a 1",
                    "Minore di 1",
                    "Intero"
                ],
                correct: 2,
                explanation: "Una frazione propria (NUM < DEN) rappresenta meno di un intero, quindi √® sempre < 1."
            },
            {
                category: "Classificazione delle Frazioni",
                question: "Quale affermazione √® VERA?",
                options: [
                    "Una frazione impropria vale sempre meno di 1",
                    "Una frazione apparente non √® mai un numero intero",
                    "Una frazione propria ha NUM < DEN",
                    "Tutte le frazioni hanno valore maggiore di 1"
                ],
                correct: 2,
                explanation: "Per definizione, una frazione propria ha il numeratore minore del denominatore."
            },
            {
                category: "Classificazione delle Frazioni",
                question: "La frazione 5/5 √®:",
                options: [
                    "Propria",
                    "Impropria",
                    "Apparente",
                    "Impossibile"
                ],
                correct: 2,
                explanation: "5/5 √® apparente perch√© NUM = DEN, quindi vale esattamente 1 (numero intero)."
            }
        ];

        let currentPhase = 1;
        let viewedCards = { 1: new Set(), 2: new Set(), 3: new Set() };
        let selectedAnswers = {};
        let quizVerified = false;
        let categoryScores = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initCards();
            initAccordions();
            initQuiz();
        });

        function initCards() {
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', () => {
                    const cardId = card.dataset.card;
                    const phase = cardId <= 4 ? 1 : 2;
                    
                    card.classList.toggle('expanded');
                    
                    if (!viewedCards[phase].has(cardId)) {
                        viewedCards[phase].add(cardId);
                        card.classList.add('viewed');
                        updateCounter(phase);
                    }
                });
            });
        }

        function initAccordions() {
            document.querySelectorAll('.accordion').forEach(acc => {
                acc.querySelector('.accordion-header').addEventListener('click', () => {
                    const accId = acc.dataset.acc;
                    
                    acc.classList.toggle('expanded');
                    
                    if (!viewedCards[3].has(accId)) {
                        viewedCards[3].add(accId);
                        acc.classList.add('viewed');
                        updateCounter(3);
                    }
                });
            });
        }

        function updateCounter(phase) {
            const total = phase === 1 ? 4 : phase === 2 ? 4 : 5;
            document.getElementById(`counter${phase}`).textContent = viewedCards[phase].size;
            
            const nextBtn = document.getElementById(`next${phase}`);
            if (viewedCards[phase].size >= total) {
                nextBtn.disabled = false;
                nextBtn.onclick = () => goToPhase(phase + 1);
            }
        }

        function initQuiz() {
            const container = document.getElementById('quiz-container');
            let currentCategory = '';
            
            quizData.forEach((q, index) => {
                if (q.category !== currentCategory) {
                    currentCategory = q.category;
                    container.innerHTML += `<h3 style="margin: 20px 0 15px; color: #2c3e50;">${currentCategory}</h3>`;
                }
                
                container.innerHTML += `
                    <div class="quiz-question" data-question="${index}">
                        <div class="question-header">
                            <span class="question-number">${index + 1}</span>
                            <span class="question-text">${q.question}</span>
                        </div>
                        <div class="options">
                            ${q.options.map((opt, i) => `
                                <div class="option" data-option="${i}" onclick="selectOption(${index}, ${i})">
                                    <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                                    <span>${opt}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="feedback" id="feedback-${index}"></div>
                    </div>
                `;
            });
        }

        function selectOption(questionIndex, optionIndex) {
            if (quizVerified) return;
            
            const question = document.querySelector(`.quiz-question[data-question="${questionIndex}"]`);
            question.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            question.querySelector(`.option[data-option="${optionIndex}"]`).classList.add('selected');
            selectedAnswers[questionIndex] = optionIndex;
        }

        function verifyQuiz() {
            // Check all questions answered
            const unanswered = [];
            quizData.forEach((_, index) => {
                if (selectedAnswers[index] === undefined) {
                    unanswered.push(index + 1);
                }
            });

            if (unanswered.length > 0) {
                alert(`Rispondi a tutte le domande prima di verificare.\nDomande mancanti: ${unanswered.join(', ')}`);
                const firstUnanswered = document.querySelector(`.quiz-question[data-question="${unanswered[0] - 1}"]`);
                firstUnanswered.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            quizVerified = true;
            let correctCount = 0;
            categoryScores = {};

            quizData.forEach((q, index) => {
                const question = document.querySelector(`.quiz-question[data-question="${index}"]`);
                const selectedOpt = question.querySelector(`.option[data-option="${selectedAnswers[index]}"]`);
                const correctOpt = question.querySelector(`.option[data-option="${q.correct}"]`);
                const feedback = document.getElementById(`feedback-${index}`);
                
                // Initialize category
                if (!categoryScores[q.category]) {
                    categoryScores[q.category] = { correct: 0, total: 0 };
                }
                categoryScores[q.category].total++;

                // Disable all options
                question.querySelectorAll('.option').forEach(opt => opt.classList.add('disabled'));

                if (selectedAnswers[index] === q.correct) {
                    correctCount++;
                    categoryScores[q.category].correct++;
                    selectedOpt.classList.add('correct');
                    question.classList.add('answered-correct');
                    feedback.className = 'feedback show correct';
                    feedback.textContent = '‚úì Corretto! ' + q.explanation;
                } else {
                    selectedOpt.classList.add('wrong');
                    correctOpt.classList.add('correct');
                    question.classList.add('answered-wrong');
                    feedback.className = 'feedback show wrong';
                    feedback.textContent = '‚úó Sbagliato. ' + q.explanation;
                }
            });

            document.getElementById('finalScore').textContent = correctCount;
            
            // Change button
            const verifyBtn = document.getElementById('verifyBtn');
            verifyBtn.textContent = 'Vai al Ripasso ‚Üí';
            verifyBtn.onclick = () => goToPhase(5);
            
            generateReview();
        }

        function generateReview() {
            const container = document.getElementById('review-container');
            container.innerHTML = '';

            // Raccogli domande errate per categoria
            const wrongByCategory = {};
            quizData.forEach((q, index) => {
                if (selectedAnswers[index] !== q.correct) {
                    if (!wrongByCategory[q.category]) {
                        wrongByCategory[q.category] = [];
                    }
                    wrongByCategory[q.category].push({
                        question: q.question,
                        yourAnswer: q.options[selectedAnswers[index]],
                        correctAnswer: q.options[q.correct],
                        explanation: q.explanation
                    });
                }
            });

            // Category 1: Definizioni e Struttura
            const cat1 = categoryScores['Definizioni e Struttura'];
            const cat1Mastered = cat1.correct >= 3;
            
            let cat1Html = `
                <div class="review-section ${cat1Mastered ? 'mastered' : 'needs-review'}">
                    <h3>${cat1Mastered ? '‚úì Hai capito bene' : '‚ö† Da rivedere'}: Definizioni e Struttura</h3>
                    <p><strong>Punteggio:</strong> ${cat1.correct}/${cat1.total}</p>
                    ${cat1Mastered ? `
                        <p>Ottimo lavoro! Hai compreso i concetti di numeratore, denominatore, frazioni equivalenti e complementari.</p>
                    ` : `
                        <p><strong>Ricorda:</strong></p>
                        <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                            <li><strong>Numeratore:</strong> quante parti si considerano</li>
                            <li><strong>Denominatore:</strong> in quante parti √® diviso l'intero</li>
                            <li><strong>Frazioni equivalenti:</strong> rappresentano la stessa quantit√†</li>
                            <li><strong>Propriet√† invariantiva:</strong> moltiplica/dividi NUM e DEN per lo stesso numero</li>
                            <li><strong>Frazione complementare:</strong> la parte mancante per arrivare a 1</li>
                        </ul>
                    `}`;
            
            if (wrongByCategory['Definizioni e Struttura']) {
                cat1Html += `<div style="margin-top: 15px; padding: 15px; background: #fff; border-radius: 10px;">
                    <strong>üìã Le tue risposte errate:</strong>`;
                wrongByCategory['Definizioni e Struttura'].forEach(w => {
                    cat1Html += `<div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #e74c3c;">
                        <p><strong>Domanda:</strong> ${w.question}</p>
                        <p style="color: #e74c3c;">‚ùå Tua risposta: ${w.yourAnswer}</p>
                        <p style="color: #27ae60;">‚úì Risposta corretta: ${w.correctAnswer}</p>
                        <p style="font-size: 0.9em; color: #666;">${w.explanation}</p>
                    </div>`;
                });
                cat1Html += `</div>`;
            }
            cat1Html += `</div>`;
            container.innerHTML += cat1Html;

            // Category 2: Classificazione
            const cat2 = categoryScores['Classificazione delle Frazioni'];
            const cat2Mastered = cat2.correct >= 3;
            
            let cat2Html = `
                <div class="review-section ${cat2Mastered ? 'mastered' : 'needs-review'}">
                    <h3>${cat2Mastered ? '‚úì Hai capito bene' : '‚ö† Da rivedere'}: Classificazione delle Frazioni</h3>
                    <p><strong>Punteggio:</strong> ${cat2.correct}/${cat2.total}</p>
                    ${cat2Mastered ? `
                        <p>Ottimo lavoro! Sai riconoscere i diversi tipi di frazione.</p>
                    ` : `
                        <p><strong>Ricorda la regola del confronto NUM vs DEN:</strong></p>
                        <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                            <li><strong>PROPRIA:</strong> NUM &lt; DEN ‚Üí valore &lt; 1</li>
                            <li><strong>IMPROPRIA:</strong> NUM &gt; DEN ‚Üí valore &gt; 1</li>
                            <li><strong>APPARENTE:</strong> NUM multiplo di DEN ‚Üí valore intero</li>
                        </ul>
                    `}`;
            
            if (wrongByCategory['Classificazione delle Frazioni']) {
                cat2Html += `<div style="margin-top: 15px; padding: 15px; background: #fff; border-radius: 10px;">
                    <strong>üìã Le tue risposte errate:</strong>`;
                wrongByCategory['Classificazione delle Frazioni'].forEach(w => {
                    cat2Html += `<div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #e74c3c;">
                        <p><strong>Domanda:</strong> ${w.question}</p>
                        <p style="color: #e74c3c;">‚ùå Tua risposta: ${w.yourAnswer}</p>
                        <p style="color: #27ae60;">‚úì Risposta corretta: ${w.correctAnswer}</p>
                        <p style="font-size: 0.9em; color: #666;">${w.explanation}</p>
                    </div>`;
                });
                cat2Html += `</div>`;
            }
            cat2Html += `</div>`;
            container.innerHTML += cat2Html;
        }

        function goToPhase(phase) {
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById(`phase${phase}`).classList.add('active');
            
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active');
                if (index + 1 < phase) step.classList.add('completed');
                if (index + 1 === phase) step.classList.add('active');
            });
            
            currentPhase = phase;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
