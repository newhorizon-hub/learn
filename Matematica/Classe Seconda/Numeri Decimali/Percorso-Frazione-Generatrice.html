<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Frazione Generatrice ‚Äî Percorso Didattico</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
<style>
:root {
  --col-limitato: #1e5ac8;
  --col-limitato-bg: #eef3fc;
  --col-periodico: #b45000;
  --col-periodico-bg: #fdf3ea;
  --col-misto: #8c1478;
  --col-misto-bg: #f9edf7;
  --col-verde: #289130;
  --col-verde-bg: #edf7ee;
  --col-grigio: #646464;
  --col-sfondo: #f8f9fc;
  --col-bordo: #d8dce6;
  --col-testo: #1a1a2e;
  --col-errore: #c0392b;
  --col-corretto: #27ae60;
  --radius: 10px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--col-sfondo);
  color: var(--col-testo);
  line-height: 1.6;
  min-height: 100vh;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 16px;
}

/* === HEADER === */
header {
  text-align: center;
  padding: 28px 16px 20px;
  background: linear-gradient(135deg, var(--col-limitato), var(--col-misto));
  color: white;
  border-radius: 0 0 var(--radius) var(--radius);
  margin-bottom: 20px;
}
header h1 { font-size: 1.6em; margin-bottom: 4px; }
header p { font-size: 0.95em; opacity: 0.9; }

/* === PROGRESS BAR === */
.progress-wrap {
  background: white;
  border-radius: var(--radius);
  padding: 14px 18px;
  margin-bottom: 20px;
  border: 1px solid var(--col-bordo);
  position: sticky;
  top: 0;
  z-index: 100;
}
.progress-label {
  font-size: 0.82em;
  color: var(--col-grigio);
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
}
.progress-bar-bg {
  height: 8px;
  background: #e8eaf0;
  border-radius: 4px;
  overflow: hidden;
}
.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--col-limitato), var(--col-misto));
  border-radius: 4px;
  transition: width 0.5s ease;
  width: 0%;
}
.progress-steps {
  display: flex;
  justify-content: space-between;
  margin-top: 8px;
}
.progress-step {
  font-size: 0.72em;
  color: #aaa;
  font-weight: 600;
  transition: color 0.3s;
}
.progress-step.active { color: var(--col-limitato); }
.progress-step.done { color: var(--col-corretto); }

/* === PHASES === */
.phase { display: none; }
.phase.visible { display: block; }

.phase-title {
  font-size: 1.25em;
  font-weight: 700;
  margin-bottom: 6px;
  color: var(--col-testo);
}
.phase-subtitle {
  font-size: 0.88em;
  color: var(--col-grigio);
  margin-bottom: 18px;
}

/* === CARDS (Phase 1, 2) === */
.card-grid {
  display: grid;
  gap: 14px;
}
.card-grid.three { grid-template-columns: 1fr; }

.card {
  background: white;
  border: 2px solid var(--col-bordo);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.3s ease;
  overflow: hidden;
  position: relative;
}
.card:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.08); }
.card.opened { cursor: default; }
.card.opened:hover { transform: none; box-shadow: none; }

.card.type-limitato { border-color: var(--col-limitato); }
.card.type-limitato .card-header { background: var(--col-limitato); }
.card.type-periodico { border-color: var(--col-periodico); }
.card.type-periodico .card-header { background: var(--col-periodico); }
.card.type-misto { border-color: var(--col-misto); }
.card.type-misto .card-header { background: var(--col-misto); }
.card.type-verde { border-color: var(--col-verde); }
.card.type-verde .card-header { background: var(--col-verde); }

.card-header {
  padding: 12px 16px;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  font-size: 0.95em;
}
.card-header .card-icon { font-size: 1.2em; }
.card-check {
  width: 22px; height: 22px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.5);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.75em;
  transition: all 0.3s;
}
.card.opened .card-check {
  background: white;
  border-color: white;
  color: var(--col-corretto);
}

.card-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s ease, padding 0.3s ease;
  padding: 0 16px;
  background: white;
}
.card.opened .card-body {
  max-height: 800px;
  padding: 16px;
}

.card-body p { margin-bottom: 10px; font-size: 0.9em; }
.card-body .formula-box {
  background: var(--col-sfondo);
  border-radius: 8px;
  padding: 12px 16px;
  margin: 10px 0;
  text-align: center;
  font-size: 1.05em;
  border: 1px solid var(--col-bordo);
}
.card-body .example {
  background: #f0f7f1;
  border-left: 3px solid var(--col-corretto);
  padding: 8px 12px;
  margin: 8px 0;
  border-radius: 0 6px 6px 0;
  font-size: 0.88em;
}
.card-body .warning {
  background: #fef9e7;
  border-left: 3px solid #f39c12;
  padding: 8px 12px;
  margin: 8px 0;
  border-radius: 0 6px 6px 0;
  font-size: 0.88em;
}

/* === EXPANDABLE CARDS (Phase 3) === */
.concept-card {
  background: white;
  border: 1px solid var(--col-bordo);
  border-radius: var(--radius);
  margin-bottom: 12px;
  overflow: hidden;
  transition: all 0.3s;
}
.concept-header {
  padding: 14px 16px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  font-size: 0.95em;
  transition: background 0.2s;
}
.concept-header:hover { background: var(--col-sfondo); }
.concept-header .concept-emoji { margin-right: 10px; font-size: 1.15em; }
.concept-arrow {
  transition: transform 0.3s;
  font-size: 0.8em;
  color: var(--col-grigio);
}
.concept-card.open .concept-arrow { transform: rotate(180deg); }
.concept-card.opened-once .concept-header .concept-check { color: var(--col-corretto); }

.concept-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s ease;
  padding: 0 16px;
}
.concept-card.open .concept-body {
  max-height: 600px;
  padding: 0 16px 16px;
}
.concept-body p { margin-bottom: 8px; font-size: 0.9em; }

/* === QUIZ (Phase 4) === */
.quiz-area-label {
  font-size: 0.82em;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--col-grigio);
  margin: 20px 0 10px;
  padding-bottom: 4px;
  border-bottom: 2px solid var(--col-bordo);
}

.question-block {
  background: white;
  border: 1px solid var(--col-bordo);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 14px;
  transition: border-color 0.3s;
}
.question-block.correct { border-color: var(--col-corretto); background: #f0faf2; }
.question-block.wrong { border-color: var(--col-errore); background: #fdf0ef; }
.question-block.unanswered-highlight { border-color: #f39c12; box-shadow: 0 0 0 2px rgba(243,156,18,0.3); }

.question-text {
  font-weight: 600;
  margin-bottom: 12px;
  font-size: 0.95em;
}
.question-num {
  display: inline-block;
  background: var(--col-limitato);
  color: white;
  width: 24px; height: 24px;
  border-radius: 50%;
  text-align: center;
  line-height: 24px;
  font-size: 0.78em;
  margin-right: 8px;
}

.option-label {
  display: flex;
  align-items: center;
  padding: 10px 14px;
  margin-bottom: 6px;
  border-radius: 8px;
  cursor: pointer;
  border: 1px solid var(--col-bordo);
  transition: all 0.2s;
  font-size: 0.9em;
}
.option-label:hover { background: var(--col-sfondo); border-color: var(--col-limitato); }
.option-label input { display: none; }
.option-radio {
  width: 18px; height: 18px;
  border-radius: 50%;
  border: 2px solid #bbb;
  margin-right: 12px;
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
}
.option-label.selected .option-radio {
  border-color: var(--col-limitato);
  background: var(--col-limitato);
}
.option-label.selected .option-radio::after {
  content: '';
  width: 6px; height: 6px;
  background: white;
  border-radius: 50%;
}
.option-label.disabled { pointer-events: none; opacity: 0.85; }
.option-label.correct-answer { border-color: var(--col-corretto); background: #e8f8ed; }
.option-label.wrong-answer { border-color: var(--col-errore); background: #fde8e6; }

.feedback-box {
  margin-top: 10px;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 0.85em;
  display: none;
}
.feedback-box.show { display: block; }
.feedback-box.correct { background: #e8f8ed; color: #1a7a3a; border-left: 3px solid var(--col-corretto); }
.feedback-box.wrong { background: #fde8e6; color: #922; border-left: 3px solid var(--col-errore); }

/* === BUTTONS === */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 28px;
  border: none;
  border-radius: 8px;
  font-size: 0.95em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}
.btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
.btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

.btn-primary {
  background: linear-gradient(135deg, var(--col-limitato), var(--col-misto));
  color: white;
}
.btn-secondary {
  background: white;
  color: var(--col-testo);
  border: 2px solid var(--col-bordo);
}
.btn-verify {
  background: var(--col-verde);
  color: white;
}

.btn-row {
  display: flex;
  gap: 12px;
  margin-top: 24px;
  flex-wrap: wrap;
  justify-content: center;
}

.missing-warning {
  background: #fef9e7;
  border: 1px solid #f39c12;
  border-radius: 8px;
  padding: 12px 16px;
  margin-top: 14px;
  font-size: 0.88em;
  color: #856404;
  display: none;
}
.missing-warning.show { display: block; }

/* === REVIEW (Phase 5) === */
.review-section {
  background: white;
  border-radius: var(--radius);
  padding: 18px;
  margin-bottom: 16px;
  border: 2px solid var(--col-bordo);
}
.review-section.needs-review {
  border-color: #f39c12;
  background: #fffdf5;
}
.review-section.good {
  border-color: var(--col-corretto);
  background: #f0faf2;
}
.review-label {
  display: inline-block;
  padding: 3px 12px;
  border-radius: 20px;
  font-size: 0.78em;
  font-weight: 700;
  margin-bottom: 10px;
}
.review-label.needs-review { background: #fdebd0; color: #a0522d; }
.review-label.good { background: #d4efdf; color: #1a7a3a; }
.review-section h3 { font-size: 1em; margin-bottom: 8px; }
.review-section p { font-size: 0.88em; margin-bottom: 6px; }

.score-box {
  text-align: center;
  background: white;
  border: 2px solid var(--col-bordo);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 20px;
}
.score-big {
  font-size: 2.4em;
  font-weight: 800;
  background: linear-gradient(135deg, var(--col-limitato), var(--col-misto));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.score-label { font-size: 0.9em; color: var(--col-grigio); margin-top: 4px; }

/* === PRINT === */
@media print {
  [id^="phase"] { display: none !important; }
  #phase5 { display: block !important; }
  header, .progress-wrap, .btn-row, .btn { display: none !important; }
  .review-section { break-inside: avoid; border-width: 1px; }
  body { background: white; }
}

/* === RESPONSIVE === */
@media (max-width: 600px) {
  .container { padding: 10px; }
  header h1 { font-size: 1.3em; }
  .card-header { padding: 10px 14px; font-size: 0.88em; }
  .btn { padding: 10px 20px; font-size: 0.88em; }
  .score-big { font-size: 1.8em; }
}
</style>
</head>
<body>

<header>
  <h1>La Frazione Generatrice</h1>
  <p>Percorso didattico interattivo ‚Äî Matematica</p>
</header>

<div class="container">

<!-- PROGRESS BAR -->
<div class="progress-wrap">
  <div class="progress-label">
    <span id="progress-text">Fase 1 di 5</span>
    <span id="progress-pct">0%</span>
  </div>
  <div class="progress-bar-bg">
    <div class="progress-bar-fill" id="progress-fill"></div>
  </div>
  <div class="progress-steps">
    <span class="progress-step active" data-phase="1">Tipi</span>
    <span class="progress-step" data-phase="2">Regole</span>
    <span class="progress-step" data-phase="3">Concetti</span>
    <span class="progress-step" data-phase="4">Verifica</span>
    <span class="progress-step" data-phase="5">Ripasso</span>
  </div>
</div>

<!-- ========== PHASE 1 ‚Äî I tre tipi di numero decimale ========== -->
<div class="phase visible" id="phase1">
  <div class="phase-title">Fase 1 ‚Äî I tre tipi di numero decimale</div>
  <div class="phase-subtitle">Clicca su ogni card per scoprire le caratteristiche di ciascun tipo.</div>

  <div class="card-grid three">

    <!-- Limitato -->
    <div class="card type-limitato" data-phase="1" onclick="toggleCard(this)">
      <div class="card-header">
        <span><span class="card-icon">üìè</span> Decimale limitato</span>
        <span class="card-check">‚úî</span>
      </div>
      <div class="card-body">
        <p><strong>Definizione:</strong> un numero decimale le cui cifre dopo la virgola sono in numero finito. Prima o poi le cifre finiscono.</p>
        <div class="formula-box">
          \(0{,}5 \qquad 0{,}75 \qquad 1{,}24 \qquad 2{,}8 \qquad 0{,}125\)
        </div>
        <p><strong>Come riconoscerlo:</strong> scrivi il numero e le cifre decimali si esauriscono. Non c'√® nessun gruppo di cifre che si ripete all'infinito.</p>
        <div class="example">
          ‚úî Esempio: \(0{,}75\) ha esattamente 2 cifre dopo la virgola, poi il numero finisce.
        </div>
      </div>
    </div>

    <!-- Periodico semplice -->
    <div class="card type-periodico" data-phase="1" onclick="toggleCard(this)">
      <div class="card-header">
        <span><span class="card-icon">üîÅ</span> Periodico semplice</span>
        <span class="card-check">‚úî</span>
      </div>
      <div class="card-body">
        <p><strong>Definizione:</strong> un numero decimale in cui un gruppo di cifre, chiamato <strong>periodo</strong>, si ripete all'infinito subito dopo la virgola.</p>
        <div class="formula-box">
          \(0{,}\overline{3} \qquad 0{,}\overline{6} \qquad 1{,}\overline{23} \qquad 2{,}\overline{5} \qquad 4{,}\overline{18}\)
        </div>
        <p><strong>Come riconoscerlo:</strong> subito dopo la virgola inizia la ripetizione. Non ci sono cifre tra la virgola e il periodo.</p>
        <div class="example">
          ‚úî Esempio: \(0{,}\overline{27} = 0{,}272727\ldots\) ‚Äî il periodo \(27\) parte subito dopo la virgola.
        </div>
        <div class="warning">
          ‚ö† Il periodo viene indicato con una linea sopra le cifre che si ripetono: \(\overline{27}\) significa che \(27\) si ripete all'infinito.
        </div>
      </div>
    </div>

    <!-- Periodico misto -->
    <div class="card type-misto" data-phase="1" onclick="toggleCard(this)">
      <div class="card-header">
        <span><span class="card-icon">üîÄ</span> Periodico misto</span>
        <span class="card-check">‚úî</span>
      </div>
      <div class="card-body">
        <p><strong>Definizione:</strong> un numero decimale in cui, dopo la virgola, ci sono prima una o pi√π cifre che <strong>non si ripetono</strong> (l'<strong>antiperiodo</strong>), poi un gruppo di cifre che si ripete all'infinito (il <strong>periodo</strong>).</p>
        <div class="formula-box">
          \(0{,}8\overline{3} \qquad 3{,}1\overline{45} \qquad 1{,}16\overline{6} \qquad 2{,}3\overline{7}\)
        </div>
        <p><strong>Come riconoscerlo:</strong> tra la virgola e il periodo c'√® almeno una cifra che non si ripete. Quella cifra (o quelle cifre) √® l'antiperiodo.</p>
        <div class="example">
          ‚úî Esempio: \(0{,}8\overline{3} = 0{,}8333\ldots\) ‚Äî l'\(8\) non si ripete (antiperiodo), il \(3\) si ripete all'infinito (periodo).
        </div>
        <div class="warning">
          ‚ö† Non confondere: nel periodico <strong>semplice</strong> il periodo parte subito dopo la virgola. Nel periodico <strong>misto</strong> c'√® l'antiperiodo in mezzo.
        </div>
      </div>
    </div>

  </div>

  <div class="btn-row">
    <button class="btn btn-primary" id="btn-to-phase2" disabled onclick="goToPhase(2)">Avanti: le regole ‚û§</button>
  </div>
</div>

<!-- ========== PHASE 2 ‚Äî Le tre regole ========== -->
<div class="phase" id="phase2">
  <div class="phase-title">Fase 2 ‚Äî Le tre regole della frazione generatrice</div>
  <div class="phase-subtitle">Clicca su ogni card per scoprire la regola di ciascun tipo.</div>

  <div class="card-grid three">

    <!-- Regola limitato -->
    <div class="card type-limitato" data-phase="2" onclick="toggleCard(this)">
      <div class="card-header">
        <span><span class="card-icon">üìè</span> Regola per il decimale limitato</span>
        <span class="card-check">‚úî</span>
      </div>
      <div class="card-body">
        <div class="formula-box">
          \(\dfrac{\text{numero senza virgola}}{1\underbrace{0\ldots0}_{\text{cifre decimali}}}\)
        </div>
        <p><strong>Al numeratore:</strong> il numero scritto senza la virgola.</p>
        <p><strong>Al denominatore:</strong> \(1\) seguito da tanti zeri quante sono le cifre dopo la virgola.</p>
        <div class="example">
          ‚úî \(0{,}75 = \dfrac{75}{100} = \dfrac{3}{4}\) ‚Äî 2 cifre decimali, quindi denominatore \(100\) (1 seguito da 2 zeri).
        </div>
        <div class="example">
          ‚úî \(0{,}125 = \dfrac{125}{1000} = \dfrac{1}{8}\) ‚Äî 3 cifre decimali, quindi denominatore \(1000\) (1 seguito da 3 zeri).
        </div>
      </div>
    </div>

    <!-- Regola periodico semplice -->
    <div class="card type-periodico" data-phase="2" onclick="toggleCard(this)">
      <div class="card-header">
        <span><span class="card-icon">üîÅ</span> Regola per il periodico semplice</span>
        <span class="card-check">‚úî</span>
      </div>
      <div class="card-body">
        <div class="formula-box">
          \(\dfrac{\text{numero senza virgola} \;-\; \text{parte intera}}{\underbrace{9\ldots9}_{\text{cifre del periodo}}}\)
        </div>
        <p><strong>Al numeratore:</strong> il numero scritto senza la virgola, meno la parte intera (tutto ci√≤ che sta prima della virgola).</p>
        <p><strong>Al denominatore:</strong> tanti \(9\) quante sono le cifre del periodo.</p>
        <div class="example">
          ‚úî \(0{,}\overline{27} = \dfrac{27 - 0}{99} = \dfrac{27}{99} = \dfrac{3}{11}\) ‚Äî periodo di 2 cifre, quindi denominatore \(99\) (due 9).
        </div>
        <div class="example">
          ‚úî \(2{,}\overline{5} = \dfrac{25 - 2}{9} = \dfrac{23}{9}\) ‚Äî periodo di 1 cifra, quindi denominatore \(9\) (un 9).
        </div>
      </div>
    </div>

    <!-- Regola periodico misto -->
    <div class="card type-misto" data-phase="2" onclick="toggleCard(this)">
      <div class="card-header">
        <span><span class="card-icon">üîÄ</span> Regola per il periodico misto</span>
        <span class="card-check">‚úî</span>
      </div>
      <div class="card-body">
        <div class="formula-box">
          \(\dfrac{\text{numero senza virgola} \;-\; \text{parte intera e antiperiodo}}{\underbrace{9\ldots9}_{\text{periodo}}\;\underbrace{0\ldots0}_{\text{antiperiodo}}}\)
        </div>
        <p><strong>Al numeratore:</strong> il numero scritto senza la virgola, meno la parte intera e l'antiperiodo (tutto ci√≤ che sta prima del periodo).</p>
        <p><strong>Al denominatore:</strong> tanti \(9\) quante le cifre del periodo, seguiti da tanti \(0\) quante le cifre dell'antiperiodo.</p>
        <div class="example">
          ‚úî \(0{,}8\overline{3} = \dfrac{83 - 8}{90} = \dfrac{75}{90} = \dfrac{5}{6}\) ‚Äî periodo di 1 cifra (\(9\)), antiperiodo di 1 cifra (\(0\)), quindi denominatore \(90\).
        </div>
        <div class="example">
          ‚úî \(3{,}1\overline{45} = \dfrac{3145 - 31}{990} = \dfrac{3114}{990} = \dfrac{173}{55}\) ‚Äî periodo di 2 cifre (due \(9\)), antiperiodo di 1 cifra (uno \(0\)), quindi denominatore \(990\).
        </div>
      </div>
    </div>

  </div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="goToPhase(1)">‚Üê Indietro</button>
    <button class="btn btn-primary" id="btn-to-phase3" disabled onclick="goToPhase(3)">Avanti: concetti chiave ‚û§</button>
  </div>
</div>

<!-- ========== PHASE 3 ‚Äî Concetti chiave ========== -->
<div class="phase" id="phase3">
  <div class="phase-title">Fase 3 ‚Äî Concetti chiave</div>
  <div class="phase-subtitle">Apri ogni scheda per approfondire. Devi aprirle tutte prima di proseguire.</div>

  <!-- Concept 1 -->
  <div class="concept-card" onclick="toggleConcept(this)">
    <div class="concept-header">
      <span><span class="concept-emoji">üîó</span> Come scegliere il tipo di numero</span>
      <span class="concept-arrow">‚ñº</span>
    </div>
    <div class="concept-body">
      <p>Segui queste domande in sequenza:</p>
      <p><strong>1.</strong> Il numero ha la virgola? Se no, √® un <strong>numero intero</strong>.</p>
      <p><strong>2.</strong> Le cifre decimali finiscono? Se s√¨, √® un <strong>decimale limitato</strong>.</p>
      <p><strong>3.</strong> C'√® l'antiperiodo? Se no, √® un <strong>periodico semplice</strong>. Se s√¨, √® un <strong>periodico misto</strong>.</p>
    </div>
  </div>

  <!-- Concept 2 -->
  <div class="concept-card" onclick="toggleConcept(this)">
    <div class="concept-header">
      <span><span class="concept-emoji">‚ú¶</span> Il segreto del denominatore: zeri e nove</span>
      <span class="concept-arrow">‚ñº</span>
    </div>
    <div class="concept-body">
      <p>Il denominatore della frazione generatrice √® costruito con sole due cifre: lo <strong>zero</strong> e il <strong>nove</strong>.</p>
      <p>I <strong>nove</strong> corrispondono sempre alle cifre del <strong>periodo</strong>: tante cifre nel periodo, tanti nove nel denominatore.</p>
      <p>Gli <strong>zeri</strong> corrispondono alle cifre che non si ripetono dopo la virgola: nel decimale limitato sono le cifre decimali (con un 1 davanti), nel periodico misto sono le cifre dell'antiperiodo.</p>
      <p>Un decimale limitato ha solo zeri (preceduti da 1). Un periodico semplice ha solo nove. Un periodico misto li ha entrambi: prima i nove, poi gli zeri.</p>
    </div>
  </div>

  <!-- Concept 3 -->
  <div class="concept-card" onclick="toggleConcept(this)">
    <div class="concept-header">
      <span><span class="concept-emoji">üîç</span> Il numeratore: cosa sottrarre</span>
      <span class="concept-arrow">‚ñº</span>
    </div>
    <div class="concept-body">
      <p>Il numeratore si calcola sempre partendo dal <strong>numero scritto senza la virgola</strong>.</p>
      <p>Per il <strong>decimale limitato</strong>: il numeratore √® semplicemente il numero senza virgola. Non si sottrae nulla.</p>
      <p>Per il <strong>periodico semplice</strong>: si sottrae la <strong>parte intera</strong> (tutto ci√≤ che sta prima della virgola).</p>
      <p>Per il <strong>periodico misto</strong>: si sottrae la <strong>parte intera e l'antiperiodo</strong> (tutto ci√≤ che sta prima del periodo).</p>
      <p>La regola √® semplice: si sottrae sempre ci√≤ che non si ripete.</p>
    </div>
  </div>

  <!-- Concept 4 -->
  <div class="concept-card" onclick="toggleConcept(this)">
    <div class="concept-header">
      <span><span class="concept-emoji">üîÑ</span> Riduzione ai minimi termini</span>
      <span class="concept-arrow">‚ñº</span>
    </div>
    <div class="concept-body">
      <p>Dopo aver trovato la frazione generatrice, controlla sempre se √® riducibile ai <strong>minimi termini</strong>.</p>
      <p>Cerca il <strong>MCD</strong> (Massimo Comun Divisore) tra numeratore e denominatore e dividi entrambi per quel valore.</p>
      <p>Esempio: \(\dfrac{75}{90}\) ‚Äî il MCD tra 75 e 90 √® 15, quindi \(\dfrac{75}{90} = \dfrac{75 \div 15}{90 \div 15} = \dfrac{5}{6}\).</p>
      <p>Se la frazione √® gi√† ridotta ai minimi termini (il MCD √® 1), lasciala cos√¨ com'√®.</p>
    </div>
  </div>

  <!-- Concept 5 -->
  <div class="concept-card" onclick="toggleConcept(this)">
    <div class="concept-header">
      <span><span class="concept-emoji">‚ö†</span> Errori frequenti</span>
      <span class="concept-arrow">‚ñº</span>
    </div>
    <div class="concept-body">
      <p><strong>Confondere antiperiodo e periodo:</strong> nel numero \(0{,}8\overline{3}\), l'antiperiodo √® \(8\) e il periodo √® \(3\). Non scambiarli quando costruisci il denominatore.</p>
      <p><strong>Sbagliare la sottrazione al numeratore:</strong> nel periodico misto, il numero che sottrai deve includere sia la parte intera sia l'antiperiodo. Per \(3{,}1\overline{45}\) si sottrae \(31\), non soltanto \(3\).</p>
      <p><strong>Dimenticare la riduzione:</strong> la frazione ottenuta spesso non √® ai minimi termini. Controlla sempre se puoi semplificare.</p>
      <p><strong>Sbagliare il conteggio delle cifre:</strong> conta con attenzione le cifre del periodo e dell'antiperiodo. Un errore nel conteggio produce un denominatore sbagliato.</p>
    </div>
  </div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="goToPhase(2)">‚Üê Indietro</button>
    <button class="btn btn-primary" id="btn-to-phase4" disabled onclick="goToPhase(4)">Avanti: verifica ‚û§</button>
  </div>
</div>

<!-- ========== PHASE 4 ‚Äî Verifica ========== -->
<div class="phase" id="phase4">
  <div class="phase-title">Fase 4 ‚Äî Verifica</div>
  <div class="phase-subtitle">Rispondi a tutte le domande, poi clicca su "Verifica risposte".</div>

  <div class="quiz-area-label">Area 1 ‚Äî Riconoscimento e classificazione</div>
  <div id="quiz-container-area1"></div>

  <div class="quiz-area-label">Area 2 ‚Äî Calcolo della frazione generatrice</div>
  <div id="quiz-container-area2"></div>

  <div class="missing-warning" id="missing-warning">
    ‚ö† Non hai risposto a tutte le domande. Le domande senza risposta sono evidenziate.
  </div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="goToPhase(3)">‚Üê Indietro</button>
    <button class="btn btn-verify" id="btn-verify" onclick="verifyQuiz()">Verifica risposte ‚úî</button>
  </div>
</div>

<!-- ========== PHASE 5 ‚Äî Ripasso ========== -->
<div class="phase" id="phase5">
  <div class="phase-title">Fase 5 ‚Äî Ripasso personalizzato</div>
  <div class="phase-subtitle">Ecco il tuo ripasso, costruito sulle tue risposte.</div>

  <div id="score-container"></div>
  <div id="review-container"></div>

  <div class="btn-row">
    <button class="btn btn-secondary" onclick="goToPhase(4)">‚Üê Rivedi errori</button>
    <button class="btn btn-primary" onclick="window.print()">Stampa ripasso üñ®</button>
    <button class="btn btn-secondary" onclick="restart()">Ricomincia ‚Ü∫</button>
  </div>
</div>

</div><!-- /container -->

<script>
// ============================================================
// DATA
// ============================================================
const quizData = [
  // AREA 1 ‚Äî Riconoscimento e classificazione
  {
    area: 1,
    text: "Che tipo di numero decimale √® \\(0{,}75\\)?",
    options: ["Periodico semplice", "Decimale limitato", "Periodico misto", "Numero intero"],
    correct: 1,
    explanation: "Le cifre dopo la virgola sono due (7 e 5) e finiscono: √® un decimale limitato."
  },
  {
    area: 1,
    text: "Che tipo di numero decimale √® \\(0{,}\\overline{3} = 0{,}333\\ldots\\)?",
    options: ["Decimale limitato", "Periodico misto", "Periodico semplice", "Numero irrazionale"],
    correct: 2,
    explanation: "Il gruppo di cifre che si ripete (3) parte subito dopo la virgola, senza antiperiodo: √® un periodico semplice."
  },
  {
    area: 1,
    text: "Che tipo di numero decimale √® \\(2{,}1\\overline{6} = 2{,}1666\\ldots\\)?",
    options: ["Periodico semplice", "Decimale limitato", "Numero irrazionale", "Periodico misto"],
    correct: 3,
    explanation: "Dopo la virgola c'√® prima l'1 (antiperiodo, non si ripete), poi il 6 (periodo, si ripete): √® un periodico misto."
  },
  {
    area: 1,
    text: "Nel numero \\(3{,}1\\overline{45} = 3{,}14545\\ldots\\), qual √® l'antiperiodo?",
    options: ["3", "45", "1", "14"],
    correct: 2,
    explanation: "L'antiperiodo √® la cifra (o le cifre) tra la virgola e il periodo. Qui tra la virgola e il periodo 45 c'√® solo l'1: l'antiperiodo √® 1."
  },
  {
    area: 1,
    text: "Nel numero \\(0{,}\\overline{27} = 0{,}272727\\ldots\\), quante cifre ha il periodo?",
    options: ["1 cifra", "3 cifre", "2 cifre", "4 cifre"],
    correct: 2,
    explanation: "Il periodo √® il gruppo di cifre che si ripete: 27. √à formato da 2 cifre (il 2 e il 7)."
  },
  // AREA 2 ‚Äî Calcolo della frazione generatrice
  {
    area: 2,
    text: "Qual √® la frazione generatrice di \\(0{,}5\\)?",
    options: ["\\(\\dfrac{5}{100}\\)", "\\(\\dfrac{1}{2}\\)", "\\(\\dfrac{5}{9}\\)", "\\(\\dfrac{1}{5}\\)"],
    correct: 1,
    explanation: "√à un decimale limitato con 1 cifra decimale: \\(\\frac{5}{10} = \\frac{1}{2}\\)."
  },
  {
    area: 2,
    text: "Qual √® il denominatore della frazione generatrice di un periodico semplice con periodo di 2 cifre?",
    options: ["90", "100", "99", "9"],
    correct: 2,
    explanation: "Per un periodico semplice, il denominatore ha tanti 9 quante le cifre del periodo. Con 2 cifre: 99."
  },
  {
    area: 2,
    text: "Qual √® la frazione generatrice di \\(0{,}\\overline{3}\\)?",
    options: ["\\(\\dfrac{3}{10}\\)", "\\(\\dfrac{3}{99}\\)", "\\(\\dfrac{1}{3}\\)", "\\(\\dfrac{1}{9}\\)"],
    correct: 2,
    explanation: "Periodico semplice: \\(\\frac{3 - 0}{9} = \\frac{3}{9} = \\frac{1}{3}\\)."
  },
  {
    area: 2,
    text: "Per calcolare la frazione generatrice di \\(2{,}3\\overline{7}\\), quale sottrazione si esegue al numeratore?",
    options: ["\\(237 - 2\\)", "\\(237 - 23\\)", "\\(237 - 3\\)", "\\(23 - 2\\)"],
    correct: 1,
    explanation: "√à un periodico misto: al numeratore si scrive il numero senza virgola (237) meno la parte intera e l'antiperiodo (23). Quindi \\(237 - 23\\)."
  },
  {
    area: 2,
    text: "Qual √® la frazione generatrice di \\(0{,}8\\overline{3} = 0{,}833\\ldots\\)?",
    options: ["\\(\\dfrac{83}{99}\\)", "\\(\\dfrac{83}{90}\\)", "\\(\\dfrac{5}{6}\\)", "\\(\\dfrac{75}{99}\\)"],
    correct: 2,
    explanation: "Periodico misto: \\(\\frac{83 - 8}{90} = \\frac{75}{90} = \\frac{5}{6}\\). Il denominatore √® 90 (un 9 per il periodo, uno 0 per l'antiperiodo)."
  }
];

// ============================================================
// STATE
// ============================================================
const state = {
  currentPhase: 1,
  opened: { 1: new Set(), 2: new Set(), 3: new Set() },
  totals: { 1: 3, 2: 3, 3: 5 },
  quizAnswered: {},
  quizVerified: false
};

// ============================================================
// RENDER MATH
// ============================================================
function renderMath(el) {
  if (!el) return;
  renderMathInElement(el, {
    delimiters: [
      { left: "\\(", right: "\\)", display: false },
      { left: "\\[", right: "\\]", display: true }
    ],
    throwOnError: false
  });
}

// ============================================================
// INIT QUIZ
// ============================================================
function initQuiz() {
  const c1 = document.getElementById('quiz-container-area1');
  const c2 = document.getElementById('quiz-container-area2');
  quizData.forEach((q, i) => {
    const container = q.area === 1 ? c1 : c2;
    const block = document.createElement('div');
    block.className = 'question-block';
    block.id = 'q-' + i;
    let optionsHTML = '';
    q.options.forEach((opt, j) => {
      optionsHTML += `
        <label class="option-label" data-q="${i}" data-opt="${j}" onclick="selectOption(${i}, ${j})">
          <input type="radio" name="q${i}" value="${j}">
          <span class="option-radio"></span>
          <span>${opt}</span>
        </label>`;
    });
    block.innerHTML = `
      <div class="question-text">
        <span class="question-num">${i + 1}</span>${q.text}
      </div>
      ${optionsHTML}
      <div class="feedback-box" id="fb-${i}"></div>`;
    container.appendChild(block);
  });
  renderMath(c1);
  renderMath(c2);
}

// ============================================================
// CARD TOGGLE (Phase 1 & 2)
// ============================================================
function toggleCard(card) {
  if (card.classList.contains('opened')) return;
  card.classList.add('opened');
  const phase = parseInt(card.dataset.phase);
  const cards = document.querySelectorAll(`.card[data-phase="${phase}"]`);
  let idx = 0;
  cards.forEach((c, i) => { if (c === card) idx = i; });
  state.opened[phase].add(idx);
  checkPhaseComplete(phase);
}

// ============================================================
// CONCEPT TOGGLE (Phase 3)
// ============================================================
function toggleConcept(card) {
  const wasOpen = card.classList.contains('open');
  card.classList.toggle('open');
  if (!wasOpen) {
    card.classList.add('opened-once');
    const cards = document.querySelectorAll('.concept-card');
    let idx = 0;
    cards.forEach((c, i) => { if (c === card) idx = i; });
    state.opened[3].add(idx);
    checkPhaseComplete(3);
  }
}

// ============================================================
// CHECK PHASE COMPLETE
// ============================================================
function checkPhaseComplete(phase) {
  const opened = state.opened[phase].size;
  const total = state.totals[phase];
  if (opened >= total) {
    const btnId = `btn-to-phase${phase + 1}`;
    const btn = document.getElementById(btnId);
    if (btn) btn.disabled = false;
  }
}

// ============================================================
// SELECT OPTION
// ============================================================
function selectOption(qi, oi) {
  if (state.quizVerified) return;
  state.quizAnswered[qi] = oi;
  const labels = document.querySelectorAll(`label[data-q="${qi}"]`);
  labels.forEach(l => l.classList.remove('selected'));
  labels[oi].classList.add('selected');
  // remove highlight
  document.getElementById('q-' + qi).classList.remove('unanswered-highlight');
}

// ============================================================
// VERIFY QUIZ
// ============================================================
function verifyQuiz() {
  if (state.quizVerified) {
    goToPhase(5);
    return;
  }

  // Check all answered
  const unanswered = [];
  quizData.forEach((q, i) => {
    if (state.quizAnswered[i] === undefined) unanswered.push(i);
  });

  if (unanswered.length > 0) {
    document.getElementById('missing-warning').classList.add('show');
    unanswered.forEach(i => document.getElementById('q-' + i).classList.add('unanswered-highlight'));
    document.getElementById('q-' + unanswered[0]).scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  document.getElementById('missing-warning').classList.remove('show');
  state.quizVerified = true;

  // Show results
  quizData.forEach((q, i) => {
    const block = document.getElementById('q-' + i);
    const selected = state.quizAnswered[i];
    const isCorrect = selected === q.correct;

    block.classList.add(isCorrect ? 'correct' : 'wrong');

    const labels = document.querySelectorAll(`label[data-q="${i}"]`);
    labels.forEach(l => {
      l.classList.add('disabled');
      const opt = parseInt(l.dataset.opt);
      if (opt === q.correct) l.classList.add('correct-answer');
      if (opt === selected && !isCorrect) l.classList.add('wrong-answer');
    });

    const fb = document.getElementById('fb-' + i);
    fb.className = 'feedback-box show ' + (isCorrect ? 'correct' : 'wrong');
    fb.innerHTML = (isCorrect ? '‚úî Corretto! ' : '‚úò Non corretto. ') + q.explanation;
    renderMath(fb);
  });

  // Change button
  const btn = document.getElementById('btn-verify');
  btn.textContent = 'Vai al ripasso ‚û§';
  btn.className = 'btn btn-primary';
}

// ============================================================
// GENERATE REVIEW (Phase 5)
// ============================================================
function generateReview() {
  const scoreContainer = document.getElementById('score-container');
  const reviewContainer = document.getElementById('review-container');
  reviewContainer.innerHTML = '';

  let total = quizData.length;
  let correct = 0;
  let area1correct = 0, area1total = 0;
  let area2correct = 0, area2total = 0;

  quizData.forEach((q, i) => {
    const isCorrect = state.quizAnswered[i] === q.correct;
    if (isCorrect) correct++;
    if (q.area === 1) { area1total++; if (isCorrect) area1correct++; }
    if (q.area === 2) { area2total++; if (isCorrect) area2correct++; }
  });

  scoreContainer.innerHTML = `
    <div class="score-box">
      <div class="score-big">${correct}/${total}</div>
      <div class="score-label">Risposte corrette</div>
    </div>`;

  // Area 1 review
  const area1good = area1correct >= Math.ceil(area1total * 0.7);
  reviewContainer.innerHTML += `
    <div class="review-section ${area1good ? 'good' : 'needs-review'}">
      <span class="review-label ${area1good ? 'good' : 'needs-review'}">${area1good ? 'Hai capito bene' : 'Da rivedere'}</span>
      <h3>Riconoscimento e classificazione dei numeri decimali</h3>
      ${area1good ? `
        <p>Sai riconoscere correttamente i tre tipi di numero decimale e distinguere il periodo dall'antiperiodo. Continua cos√¨!</p>
      ` : `
        <p>Ripassa le caratteristiche dei tre tipi di numero decimale.</p>
        <p>Il <strong>decimale limitato</strong> ha un numero finito di cifre dopo la virgola.</p>
        <p>Il <strong>periodico semplice</strong> ha il periodo che parte subito dopo la virgola, senza antiperiodo.</p>
        <p>Il <strong>periodico misto</strong> ha prima l'antiperiodo (cifre che non si ripetono) e poi il periodo (cifre che si ripetono). Ricorda: l'antiperiodo sta tra la virgola e il periodo.</p>
        <p>Per contare le cifre del periodo, individua il gruppo che si ripete e conta quante cifre lo compongono: \\(\\overline{27}\\) ha 2 cifre, \\(\\overline{3}\\) ne ha 1.</p>
      `}
    </div>`;

  // Area 2 review
  const area2good = area2correct >= Math.ceil(area2total * 0.7);
  reviewContainer.innerHTML += `
    <div class="review-section ${area2good ? 'good' : 'needs-review'}">
      <span class="review-label ${area2good ? 'good' : 'needs-review'}">${area2good ? 'Hai capito bene' : 'Da rivedere'}</span>
      <h3>Calcolo della frazione generatrice</h3>
      ${area2good ? `
        <p>Sai applicare correttamente le regole per trovare la frazione generatrice e costruire numeratore e denominatore. Continua a esercitarti!</p>
      ` : `
        <p>Ripassa le tre regole per costruire la frazione generatrice.</p>
        <p><strong>Decimale limitato:</strong> al numeratore il numero senza virgola, al denominatore 1 seguito da tanti zeri quante le cifre decimali.</p>
        <p><strong>Periodico semplice:</strong> al numeratore il numero senza virgola meno la parte intera, al denominatore tanti 9 quante le cifre del periodo.</p>
        <p><strong>Periodico misto:</strong> al numeratore il numero senza virgola meno la parte intera e l'antiperiodo, al denominatore tanti 9 quante le cifre del periodo seguiti da tanti 0 quante le cifre dell'antiperiodo.</p>
        <p>Ricorda sempre di ridurre la frazione ai minimi termini cercando il MCD tra numeratore e denominatore.</p>
      `}
    </div>`;

  renderMath(reviewContainer);
}

// ============================================================
// NAVIGATION
// ============================================================
function goToPhase(n) {
  document.querySelectorAll('.phase').forEach(p => p.classList.remove('visible'));
  document.getElementById('phase' + n).classList.add('visible');
  state.currentPhase = n;
  updateProgress();
  window.scrollTo({ top: 0, behavior: 'smooth' });

  if (n === 5) generateReview();
}

function updateProgress() {
  const pct = Math.round(((state.currentPhase - 1) / 4) * 100);
  document.getElementById('progress-fill').style.width = pct + '%';
  document.getElementById('progress-text').textContent = `Fase ${state.currentPhase} di 5`;
  document.getElementById('progress-pct').textContent = pct + '%';

  document.querySelectorAll('.progress-step').forEach(s => {
    const p = parseInt(s.dataset.phase);
    s.classList.remove('active', 'done');
    if (p === state.currentPhase) s.classList.add('active');
    else if (p < state.currentPhase) s.classList.add('done');
  });
}

function restart() {
  state.currentPhase = 1;
  state.opened = { 1: new Set(), 2: new Set(), 3: new Set() };
  state.quizAnswered = {};
  state.quizVerified = false;

  // Reset cards
  document.querySelectorAll('.card').forEach(c => c.classList.remove('opened'));
  document.querySelectorAll('.concept-card').forEach(c => {
    c.classList.remove('open', 'opened-once');
  });

  // Reset quiz
  document.getElementById('quiz-container-area1').innerHTML = '';
  document.getElementById('quiz-container-area2').innerHTML = '';
  document.getElementById('missing-warning').classList.remove('show');
  initQuiz();

  // Reset buttons
  const btn = document.getElementById('btn-verify');
  btn.textContent = 'Verifica risposte ‚úî';
  btn.className = 'btn btn-verify';
  document.getElementById('btn-to-phase2').disabled = true;
  document.getElementById('btn-to-phase3').disabled = true;
  document.getElementById('btn-to-phase4').disabled = true;

  goToPhase(1);
}

// ============================================================
// INIT
// ============================================================
window.addEventListener('DOMContentLoaded', () => {
  initQuiz();
  updateProgress();
  renderMath(document.body);
});
</script>
</body>
</html>
